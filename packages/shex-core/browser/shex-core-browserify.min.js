!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).shexCore=e()}}(function(){return function(){return function e(t,r,n){function i(a,o){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=r[a]={exports:{}};t[a][0].call(p.exports,function(e){return i(t[a][1][e]||e)},p,p.exports,e,t,r,n)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}}()({1:[function(e,t,r){"use strict";var n=function(){function e(e,t,r,n){if("number"!=typeof e)throw new TypeError("statusCode must be a number but was "+typeof e);if(null===t)throw new TypeError("headers cannot be null");if("object"!=typeof t)throw new TypeError("headers must be an object but was "+typeof t);this.statusCode=e;var i={};for(var s in t)i[s.toLowerCase()]=t[s];this.headers=i,this.body=r,this.url=n}return e.prototype.isError=function(){return 0===this.statusCode||this.statusCode>=400},e.prototype.getBody=function(e){var t;if(0===this.statusCode)throw(t=new Error("This request to "+this.url+" resulted in a status code of 0. This usually indicates some kind of network error in a browser (e.g. CORS not being set up or the DNS failing to resolve):\n"+this.body.toString())).statusCode=this.statusCode,t.headers=this.headers,t.body=this.body,t.url=this.url,t;if(this.statusCode>=300)throw(t=new Error("Server responded to "+this.url+" with status code "+this.statusCode+":\n"+this.body.toString())).statusCode=this.statusCode,t.headers=this.headers,t.body=this.body,t.url=this.url,t;return e&&"string"!=typeof this.body?this.body.toString(e):this.body},e}();t.exports=n},{}],2:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],3:[function(e,t,r){var n,i,s=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var u,p=[],l=!1,f=-1;function d(){l&&u&&(l=!1,u.length?p=u.concat(p):f=-1,p.length&&h())}function h(){if(!l){var e=c(d);l=!0;for(var t=p.length;t;){for(u=p,p=[];++f<t;)u&&u[f].run();f=-1,t=p.length}u=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function m(){}s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new v(e,t)),1!==p.length||l||c(h)},v.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=m,s.addListener=m,s.once=m,s.off=m,s.removeListener=m,s.removeAllListeners=m,s.emit=m,s.prependListener=m,s.prependOnceListener=m,s.listeners=function(e){return[]},s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],4:[function(e,t,r){"use strict";var n=String.prototype.replace,i=/%20/g;t.exports={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,i,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},{}],5:[function(e,t,r){"use strict";var n=e("./stringify"),i=e("./parse"),s=e("./formats");t.exports={formats:s,parse:i,stringify:n}},{"./formats":4,"./parse":6,"./stringify":7}],6:[function(e,t,r){"use strict";var n=e("./utils"),i=Object.prototype.hasOwnProperty,s={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},o=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(n),o=a?n.slice(0,a.index):n,c=[];if(o){if(!r.plainObjects&&i.call(Object.prototype,o)&&!r.allowPrototypes)return;c.push(o)}for(var u=0;null!==(a=s.exec(n))&&u<r.depth;){if(u+=1,!r.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(e,t,r){for(var n=t,i=e.length-1;i>=0;--i){var s,a=e[i];if("[]"===a&&r.parseArrays)s=[].concat(n);else{s=r.plainObjects?Object.create(null):{};var o="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(o,10);r.parseArrays||""!==o?!isNaN(c)&&a!==o&&String(c)===o&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(s=[])[c]=n:s[o]=n:s={0:n}}n=s}return n}(c,t,r)}};t.exports=function(e,t){var r=function(e){if(!e)return s;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?s.charset:e.charset;return{allowDots:void 0===e.allowDots?s.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:s.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:s.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:s.comma,decoder:"function"==typeof e.decoder?e.decoder:s.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:s.delimiter,depth:"number"==typeof e.depth?e.depth:s.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:s.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:s.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var c="string"==typeof e?function(e,t){var r,o={},c=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,p=c.split(t.delimiter,u),l=-1,f=t.charset;if(t.charsetSentinel)for(r=0;r<p.length;++r)0===p[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[r]?f="utf-8":"utf8=%26%2310003%3B"===p[r]&&(f="iso-8859-1"),l=r,r=p.length);for(r=0;r<p.length;++r)if(r!==l){var d,h,v=p[r],m=v.indexOf("]="),y=-1===m?v.indexOf("="):m+1;-1===y?(d=t.decoder(v,s.decoder,f),h=t.strictNullHandling?null:""):(d=t.decoder(v.slice(0,y),s.decoder,f),h=t.decoder(v.slice(y+1),s.decoder,f)),h&&t.interpretNumericEntities&&"iso-8859-1"===f&&(h=a(h)),h&&t.comma&&h.indexOf(",")>-1&&(h=h.split(",")),i.call(o,d)?o[d]=n.combine(o[d],h):o[d]=h}return o}(e,r):e,u=r.plainObjects?Object.create(null):{},p=Object.keys(c),l=0;l<p.length;++l){var f=p[l],d=o(f,c[f],r);u=n.merge(u,d,r)}return n.compact(u)}},{"./utils":8}],7:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./formats"),s=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},o=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,o(t)?t:[t])},p=Date.prototype.toISOString,l={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,formatter:i.formatters[i.default],indices:!1,serializeDate:function(e){return p.call(e)},skipNulls:!1,strictNullHandling:!1},f=function e(t,r,i,s,a,c,p,f,d,h,v,m,y){var g=t;if("function"==typeof p?g=p(r,g):g instanceof Date?g=h(g):"comma"===i&&o(g)&&(g=g.join(",")),null===g){if(s)return c&&!m?c(r,l.encoder,y):r;g=""}if("string"==typeof g||"number"==typeof g||"boolean"==typeof g||n.isBuffer(g))return c?[v(m?r:c(r,l.encoder,y))+"="+v(c(g,l.encoder,y))]:[v(r)+"="+v(String(g))];var x,S=[];if(void 0===g)return S;if(o(p))x=p;else{var b=Object.keys(g);x=f?b.sort(f):b}for(var E=0;E<x.length;++E){var w=x[E];a&&null===g[w]||(o(g)?u(S,e(g[w],"function"==typeof i?i(r,w):r,i,s,a,c,p,f,d,h,v,m,y)):u(S,e(g[w],r+(d?"."+w:"["+w+"]"),i,s,a,c,p,f,d,h,v,m,y)))}return S};t.exports=function(e,t){var r,n=e,c=function(e){if(!e)return l;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||l.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=i.default;if(void 0!==e.format){if(!s.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=i.formatters[r],a=l.filter;return("function"==typeof e.filter||o(e.filter))&&(a=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:l.addQueryPrefix,allowDots:void 0===e.allowDots?l.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:l.charsetSentinel,delimiter:void 0===e.delimiter?l.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:l.encode,encoder:"function"==typeof e.encoder?e.encoder:l.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:l.encodeValuesOnly,filter:a,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:l.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:l.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:l.strictNullHandling}}(t);"function"==typeof c.filter?n=(0,c.filter)("",n):o(c.filter)&&(r=c.filter);var p,d=[];if("object"!=typeof n||null===n)return"";p=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var h=a[p];r||(r=Object.keys(n)),c.sort&&r.sort(c.sort);for(var v=0;v<r.length;++v){var m=r[v];c.skipNulls&&null===n[m]||u(d,f(n[m],m,h,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var y=d.join(c.delimiter),g=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?g+="utf8=%26%2310003%3B&":g+="utf8=%E2%9C%93&"),y.length>0?g+y:""}},{"./formats":4,"./utils":8}],8:[function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};t.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var s=t[n],a=s.obj[s.prop],o=Object.keys(a),c=0;c<o.length;++c){var u=o[c],p=a[u];"object"==typeof p&&null!==p&&-1===r.indexOf(p)&&(t.push({obj:a,prop:u}),r.push(p))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(i(r)){for(var n=[],s=0;s<r.length;++s)void 0!==r[s]&&n.push(r[s]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var n="string"==typeof e?e:String(e);if("iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var i="",a=0;a<n.length;++a){var o=n.charCodeAt(a);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?i+=n.charAt(a):o<128?i+=s[o]:o<2048?i+=s[192|o>>6]+s[128|63&o]:o<55296||o>=57344?i+=s[224|o>>12]+s[128|o>>6&63]+s[128|63&o]:(a+=1,o=65536+((1023&o)<<10|1023&n.charCodeAt(a)),i+=s[240|o>>18]+s[128|o>>12&63]+s[128|o>>6&63]+s[128|63&o])}return i},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,s){if(!r)return t;if("object"!=typeof r){if(i(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(s&&(s.plainObjects||s.allowPrototypes)||!n.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return i(t)&&!i(r)&&(o=a(t,s)),i(t)&&i(r)?(r.forEach(function(r,i){if(n.call(t,i)){var a=t[i];a&&"object"==typeof a&&r&&"object"==typeof r?t[i]=e(a,r,s):t.push(r)}else t[i]=r}),t):Object.keys(r).reduce(function(t,i){var a=r[i];return n.call(t,i)?t[i]=e(t[i],a,s):t[i]=a,t},o)}}},{}],9:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("then-request/lib/handle-qs.js"),i=e("http-response-object"),s=FormData;function a(e,t,r){var s,a=new XMLHttpRequest;if("string"!=typeof e)throw new TypeError("The method must be a string.");if(t&&"object"==typeof t&&(t=t.href),"string"!=typeof t)throw new TypeError("The URL/path must be a string.");if(null==r&&(r={}),"object"!=typeof r)throw new TypeError("Options must be an object (or null).");e=e.toUpperCase(),r.headers=r.headers||{};var o=!(!(s=/^([\w-]+:)?\/\/([^\/]+)/.exec(t))||s[2]==location.host);for(var c in o||(r.headers["X-Requested-With"]="XMLHttpRequest"),r.qs&&(t=n.default(t,r.qs)),r.json&&(r.body=JSON.stringify(r.json),r.headers["content-type"]="application/json"),r.form&&(r.body=r.form),a.open(e,t,!1),r.headers)a.setRequestHeader(c.toLowerCase(),""+r.headers[c]);a.send(r.body?r.body:null);var u={};return a.getAllResponseHeaders().split("\r\n").forEach(function(e){var t=e.split(":");t.length>1&&(u[t[0].toLowerCase()]=t.slice(1).join(":").trim())}),new i(a.status,u,a.responseText,t)}r.FormData=s,r.default=a,t.exports=a,t.exports.default=a,t.exports.FormData=s},{"http-response-object":1,"then-request/lib/handle-qs.js":10}],10:[function(e,t,r){"use strict";r.__esModule=!0;var n=e("qs");r.default=function(e,t){var r=e.split("?"),i=r[0],s=r[1],a=(s||"").split("#")[0],o=s&&s.split("#").length>1?"#"+s.split("#")[1]:"",c=n.parse(a);for(var u in t)c[u]=t[u];return""!==(a=n.stringify(c))&&(a="?"+a),i+a+o}},{qs:5}],11:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],12:[function(e,t,r){(function(t,n){var i=/%[sdj%]/g;r.format=function(e){if(!y(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,s=n.length,a=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=s)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),c=n[r];r<s;c=n[++r])v(c)||!S(c)?a+=" "+c:a+=" "+o(c);return a},r.deprecate=function(e,i){if(g(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return function(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}};var s,a={};function o(e,t){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(t)?n.showHidden=t:t&&r._extend(n,t),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),p(n,e,n.depth)}function c(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function u(e,t){return e}function p(e,t,n){if(e.customInspect&&t&&w(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return y(i)||(i=p(e,i,n)),i}var s=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(y(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(m(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(v(t))return e.stylize("null","null")}(e,t);if(s)return s;var a=Object.keys(t),o=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),E(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(t);if(0===a.length){if(w(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(b(t))return e.stylize(Date.prototype.toString.call(t),"date");if(E(t))return l(t)}var u,S="",O=!1,j=["{","}"];(d(t)&&(O=!0,j=["[","]"]),w(t))&&(S=" [Function"+(t.name?": "+t.name:"")+"]");return x(t)&&(S=" "+RegExp.prototype.toString.call(t)),b(t)&&(S=" "+Date.prototype.toUTCString.call(t)),E(t)&&(S=" "+l(t)),0!==a.length||O&&0!=t.length?n<0?x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=O?function(e,t,r,n,i){for(var s=[],a=0,o=t.length;a<o;++a)N(t,String(a))?s.push(f(e,t,r,n,String(a),!0)):s.push("");return i.forEach(function(i){i.match(/^\d+$/)||s.push(f(e,t,r,n,i,!0))}),s}(e,t,n,o,a):a.map(function(r){return f(e,t,n,o,r,O)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,S,j)):j[0]+S+j[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,i,s){var a,o,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?o=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(o=e.stylize("[Setter]","special")),N(n,i)||(a="["+i+"]"),o||(e.seen.indexOf(c.value)<0?(o=v(r)?p(e,c.value,null):p(e,c.value,r-1)).indexOf("\n")>-1&&(o=s?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n")):o=e.stylize("[Circular]","special")),g(a)){if(s&&i.match(/^\d+$/))return o;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+o}function d(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function v(e){return null===e}function m(e){return"number"==typeof e}function y(e){return"string"==typeof e}function g(e){return void 0===e}function x(e){return S(e)&&"[object RegExp]"===O(e)}function S(e){return"object"==typeof e&&null!==e}function b(e){return S(e)&&"[object Date]"===O(e)}function E(e){return S(e)&&("[object Error]"===O(e)||e instanceof Error)}function w(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function j(e){return e<10?"0"+e.toString(10):e.toString(10)}r.debuglog=function(e){if(g(s)&&(s=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!a[e])if(new RegExp("\\b"+e+"\\b","i").test(s)){var n=t.pid;a[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else a[e]=function(){};return a[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=h,r.isNull=v,r.isNullOrUndefined=function(e){return null==e},r.isNumber=m,r.isString=y,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=g,r.isRegExp=x,r.isObject=S,r.isDate=b,r.isError=E,r.isFunction=w,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],t].join(" ")),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!S(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":11,_process:3,inherits:2}],13:[function(e,t,r){var n=function(){var e=/^[a-z][a-z0-9+.-]*:/i,t=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,r=/(?:^|\/)\.\.?(?:$|[\/#?])/;const n="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",i="http://www.w3.org/2001/XMLSchema#string";function s(e){if(!r.test(e))return e;for(var t="",n=e.length,i=-1,s=-1,a=0,o="/";i<n;){switch(o){case":":if(s<0&&"/"===e[++i]&&"/"===e[++i])for(;(s=i+1)<n&&"/"!==e[s];)i=s;break;case"?":case"#":i=n;break;case"/":if("."===e[i+1])switch(o=e[++i+1]){case"/":t+=e.substring(a,i-1),a=i+1;break;case void 0:case"?":case"#":return t+e.substring(a,i)+e.substr(i+1);case".":if(void 0===(o=e[++i+1])||"/"===o||"?"===o||"#"===o){if((a=(t+=e.substring(a,i-2)).lastIndexOf("/"))>=s&&(t=t.substr(0,a)),"/"!==o)return t+"/"+e.substr(i+1);a=i+1}}}o=e[++i]}return t+e.substring(a)}function a(e){switch(e.termType){case"NamedNode":return e.value;case"BlankNode":return"_:"+e.value;case"Literal":return'"'+e.value+'"'+(e.datatypeString===n?"@"+e.language:e.datatypeString===i?"":"^^"+e.datatypeString);default:throw Error("unknown RDFJS node type: "+JSON.stringify(e))}}function o(e,t){if(c(e))return t.namedNode(e);if(p(e))return t.blankNode(e.substr(2));if(u(e)){let r=d(e)||(f(e)===i?null:t.namedNode(f(e)));return t.literal(l(e),r)}throw Error("Unknown internal term type: "+JSON.stringify(e))}function c(e){if("string"!=typeof e)return!1;if(0===e.length)return!0;var t=e[0];return'"'!==t&&"_"!==t}function u(e){return"string"==typeof e&&'"'===e[0]}function p(e){return"string"==typeof e&&"_:"===e.substr(0,2)}function l(e){var t=/^"([^]*)"/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]}function f(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]||(t[2]?n:i)}function d(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]?t[1].toLowerCase():""}var h=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,v=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,m={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};function y(e){var t=m[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}return{RdfLangString:n,XsdString:i,resolveRelativeIRI:function(r,n){if(e.test(n))return n;switch(n[0]){case void 0:return r;case"#":return r+n;case"?":return r.replace(/(?:\?.*)?$/,n);case"/":let e=r.match(t);return("/"===n[1]?e[1]:e[0])+s(n);default:return s(r.replace(/[^\/?]*(?:\?.*)?$/,"")+n)}},isIRI:c,isLiteral:u,isBlank:p,isDefaultGraph:function(e){return!e},inDefaultGraph:function(e){return!e.graph},getLiteralValue:l,getLiteralType:f,getLiteralLanguage:d,internalTerm:a,internalTriple:function(e){return{subject:a(e.subject),predicate:a(e.predicate),object:a(e.object)}},externalTerm:o,externalTriple:function(e,t){return{subject:o(e.subject,t),predicate:o(e.predicate,t),object:o(e.object,t)}},intermalTermToTurtle:function(e,t,r){if(c(e)){h.test(e)&&(e=e.replace(v,y));var n=Object.keys(r).find(t=>e.startsWith(r[t]));return n?n+e.substr(r[n].length):e.startsWith(t)?"<"+e.substr(t.length)+">":"<"+e+">"}if(p(e))return e;if(u(e)){var i=l(e),s=f(e),a=d(e);return h.test(i)&&(i=i.replace(v,y)),a?'"'+i+'"@'+a:s?'"'+i+'"^^'+this._encodeIriOrBlankNode(s):'"'+i+'"'}throw Error("Unknown internal term type: "+JSON.stringify(e))}}}();void 0!==e&&void 0!==r&&(t.exports=n)},{}],14:[function(t,r,n){var i=function(){var r=t("./RdfTerm");const n=t("hierarchy-closure"),i={_namespace:"http://www.w3.org/ns/shex#"};["Schema","@context","imports","startActs","start","shapes","ShapeOr","ShapeAnd","shapeExprs","nodeKind","NodeConstraint","iri","bnode","nonliteral","literal","datatype","length","minlength","maxlength","pattern","flags","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits","values","ShapeNot","shapeExpr","Shape","virtual","closed","extra","expression","inherit","semActs","ShapeRef","reference","ShapeExternal","EachOf","OneOf","expressions","min","max","annotation","TripleConstraint","inverse","negated","predicate","valueExpr","Inclusion","include","Language","languageTag","IriStem","LiteralStem","LanguageStem","stem","IriStemRange","LiteralStemRange","LanguageStemRange","exclusion","Wildcard","SemAct","name","code","Annotation","object"].forEach(e=>{i[e]=i._namespace+e});const s={_namespace:"http://www.w3.org/1999/02/22-rdf-syntax-ns#"};["type","first","rest","nil"].forEach(e=>{s[e]=s._namespace+e});const a={_namespace:"http://www.w3.org/2001/XMLSchema#"};["anyURI"].forEach(e=>{a[e]=a._namespace+e});const o={_namespace:"http://www.w3.org/2002/07/owl#"};["Thing"].forEach(e=>{o[e]=o._namespace+e});const c={};var u=-1;function p(e){e||(e={});for(var t,r=1,n=arguments.length;r<n&&(t=arguments[r]||{});r++)for(var i in t)e[i]=t[i];return e}function l(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}var f={SX:i,RDF:s,version:function(){return"0.5.0"},Visitor:function(){var e=this;var t={runtimeError:function(e){throw e},visitSchema:function(t){var r={type:"Schema"};return e._expect(t,"type","Schema"),this._maybeSet(t,r,"Schema",["prefixes","base","imports","startActs","start","shapes","productions"]),r},visitPrefixes:function(e){return void 0===e?void 0:(t=e,r=function(e){return e},n={},Object.keys(t).forEach(function(e){n[e]=r(t[e])}),n);var t,r,n},visitIRI:function(e){return e},visitImports:function(e){var t=this;return e.map(function(e){return t.visitIRI(e)})},visitStartActs:function(e){var t=this;return void 0===e?void 0:e.map(function(e){return t.visitSemAct(e)})},visitSemActs:function(e){var t=this;if(void 0!==e){var r=[];return Object.keys(e).forEach(function(n){r.push(t.visitSemAct(e[n],n))}),r}},visitSemAct:function(t,r){var n={type:"SemAct"};return e._expect(t,"type","SemAct"),this._maybeSet(t,n,"SemAct",["name","code"]),n},visitShapes:function(e){var t=this;if(void 0!==e){var r={};return Object.keys(e).forEach(function(n){r[n]=t.visitShapeExpr(e[n],n)}),r}},visitProductions:function(e){var t=this;if(void 0!==e){var r={};return Object.keys(e).forEach(function(n){r[n]=t.visitExpression(e[n],n)}),r}},visitShapeExpr:function(e,t){var r="Shape"===e.type?this.visitShape(e,t):"NodeConstraint"===e.type?this.visitNodeConstraint(e,t):"ShapeAnd"===e.type?this.visitShapeAnd(e,t):"ShapeOr"===e.type?this.visitShapeOr(e,t):"ShapeNot"===e.type?this.visitShapeNot(e,t):"ShapeRef"===e.type?this.visitShapeRef(e):"ShapeExternal"===e.type?this.visitShapeExternal(e):null;if(null===r)throw Error("unexpected shapeExpr type: "+e.type);return r},_visitShapeGroup:function(e,t){this._testUnknownAttributes(e,["id","shapeExprs"],e.type,this.visitShapeNot);var r=this,n={type:e.type};return"id"in e&&(n.id=e.id),n.shapeExprs=e.shapeExprs.map(function(e){return r.visitShapeExpr(e,t)}),n},visitShapeNot:function(e,t){this._testUnknownAttributes(e,["id","shapeExpr"],"ShapeNot",this.visitShapeNot);var r={type:e.type};return"id"in e&&(r.id=e.id),r.shapeExpr=this.visitShapeExpr(e.shapeExpr,t),r},visitShape:function(t,r){var n={type:"Shape"};return e._expect(t,"type","Shape"),this._maybeSet(t,n,"Shape",["id","closed","expression","extra","semActs","annotations"]),n},visitNodeConstraint:function(t,r){var n={type:"NodeConstraint"};return e._expect(t,"type","NodeConstraint"),this._maybeSet(t,n,"NodeConstraint",["id","nodeKind","datatype","pattern","flags","length","reference","minlength","maxlength","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits","values","annotations","semActs"]),n},visitShapeRef:function(e){return this._testUnknownAttributes(e,["reference"],"ShapeRef",this.visitShapeNot),{type:"ShapeRef",reference:e.reference}},visitShapeExternal:function(e){return this._testUnknownAttributes(e,["id"],"ShapeExternal",this.visitShapeNot),p("id"in e?{id:e.id}:{},{type:"ShapeExternal"})},_visitGroup:function(e,t){var r=this,n=Object.assign("id"in e?{id:null}:{},{type:e.type});return n.expressions=e.expressions.map(function(e){return r.visitExpression(e)}),this._maybeSet(e,n,"expr",["id","min","max","annotations","semActs"],["expressions"])},visitTripleConstraint:function(e){return this._maybeSet(e,Object.assign("id"in e?{id:null}:{},{type:"TripleConstraint"}),"TripleConstraint",["id","inverse","predicate","valueExpr","min","max","annotations","semActs"])},visitExpression:function(e){var t="TripleConstraint"===e.type?this.visitTripleConstraint(e):"OneOf"===e.type?this.visitOneOf(e):"EachOf"===e.type?this.visitEachOf(e):"Inclusion"===e.type?this.visitInclusion(e):null;if(null===t)throw Error("unexpected expression type: "+e.type);return t},visitValues:function(e){var t=this;return e.map(function(e){return l(e)||"Language"===e.type?e:t.visitStemRange(e)})},visitStemRange:function(t){var r=this;"type"in t||r.runtimeError(Error("expected "+JSON.stringify(t)+" to have a 'type' attribute."));var n,i=["IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];return-1===i.indexOf(t.type)&&r.runtimeError(Error("expected type attribute '"+t.type+"' to be in '"+i+"'.")),l(t)?(e._expect(t.stem,"type","Wildcard"),n={type:t.type,stem:{type:"Wildcard"}}):n={type:t.type,stem:t.stem},t.exclusions&&(n.exclusions=t.exclusions.map(function(e){return r.visitExclusion(e)})),n},visitExclusion:function(e){if(l(e))return e;"type"in e||_Visitor.runtimeError(Error("expected "+JSON.stringify(e)+" to have a 'type' attribute."));var t=["IriStem","LiteralStem","LanguageStem"];return-1===t.indexOf(e.type)&&_Visitor.runtimeError(Error("expected type attribute '"+e.type+"' to be in '"+t+"'.")),{type:e.type,stem:e.stem}},visitInclusion:function(t){var r={type:"Inclusion"};return e._expect(t,"type","Inclusion"),this._maybeSet(t,r,"Inclusion",["include"]),r},_maybeSet:function(e,t,r,n,i){var s=this;return this._testUnknownAttributes(e,i?n.concat(i):n,r,this._maybeSet),n.forEach(function(r){var n="visit"+r.charAt(0).toUpperCase()+r.slice(1);if(r in e){var i=s[n];if("function"!=typeof i)throw Error(n+" not found in Visitor");var a=i.call(s,e[r]);void 0!==a&&(t[r]=a)}}),t},_visitValue:function(e){return e},_visitList:function(e){return e.slice()},_testUnknownAttributes:function(e,t,r,n){var i=Object.keys(e).reduce(function(e,r){return"type"!==r&&-1===t.indexOf(r)?e.concat(r):e},[]);if(i.length>0){var s=Error("unknown propert"+(i.length>1?"ies":"y")+": "+i.map(function(e){return'"'+e+'"'}).join(",")+" in "+r+": "+JSON.stringify(e));throw Error.captureStackTrace(s,n),s}}};return t.visitBase=t.visitStart=t.visitVirtual=t.visitClosed=t._visitValue,t.visitInherit=t.visitExtra=t.visitAnnotations=t._visitList,t.visitInverse=t.visitPredicate=t._visitValue,t.visitName=t.visitId=t.visitCode=t.visitMin=t.visitMax=t._visitValue,t.visitType=t.visitNodeKind=t.visitDatatype=t.visitPattern=t.visitFlags=t.visitLength=t.visitMinlength=t.visitMaxlength=t.visitMininclusive=t.visitMinexclusive=t.visitMaxinclusive=t.visitMaxexclusive=t.visitTotaldigits=t.visitFractiondigits=t._visitValue,t.visitOneOf=t.visitEachOf=t._visitGroup,t.visitShapeAnd=t.visitShapeOr=t._visitShapeGroup,t.visitInclude=t._visitValue,t.visitValueExpr=t.visitShapeExpr,t},ShExJVisitor:function(e){var t=f.Visitor(),r=t.visitShapeExpr,n=t.visitShape,i=t.visitExpression;return t.visitShapeExpr=t.visitValueExpr=function(e,t){return"string"==typeof e?{type:"ShapeRef",reference:e}:r.call(this,e,t)},t.visitShape=function(e,t){var r=n.call(this,e,t);return"extra"in e&&r.extra.sort(),r},t.visitExpression=function(t){var r="string"==typeof t?{type:"Inclusion",include:t}:i.call(this,t);return"object"==typeof t&&"id"in t&&(e[t.id]=r),r},t},ShExJtoAS:function(e){var t=this;delete e["@context"];var r={};if("start"in e){var n=t.ShExJVisitor(r);e.start=n.visitShapeExpr(e.start)}if("shapes"in e){var i={};e.shapes.forEach(e=>{var n=e.id;delete e.id;var s=t.ShExJVisitor(r);i[n]=s.visitShapeExpr(e)}),e.shapes=i}return Object.keys(r).length>0&&(e.productions=r),e},AStoShExJ:function(e,t){t||(delete e.prefixes,delete e.base),delete e.productions,e["@context"]="http://www.w3.org/ns/shex.jsonld";var r=f.Visitor();if(r.visitShapeRef=function(e){return e.reference},r.visitInclusion=function(e){return e.include},"start"in e&&(e.start=r.visitShapeExpr(e.start)),"shapes"in e){var n=[];for(var i in e.shapes)n.push(Object.assign({id:i},r.visitShapeExpr(e.shapes[i])));e.shapes=n}return e},ShExRVisitor:function(e){var t=f.Visitor(),n={},i=t.visitShapeExpr,s=(t.visitValueExpr,t.visitExpression);return t.keepShapeExpr=i,t.visitShapeExpr=t.visitValueExpr=function(t,r){if("string"==typeof t)return t;if("id"in t){if(-1!==e.indexOf(t.id)||1===Object.keys(t).length)return t.id;delete t.id}return i.call(this,t,r)},t.visitExpression=function(e){if("string"==typeof e)return e;if("id"in e&&e.id in n)return n[e.id].refCount++,e.id;var t=s.call(this,e);return n[e.id]={refCount:1,expr:t},t},t.cleanIds=function(){for(var e in n){var t=n[e];1===t.refCount&&r.isBlank(t.expr.id)&&delete t.expr.id}},t},ShExRtoShExJ:function(e){var t=[];"shapes"in e&&(t=t.concat(e.shapes.map(e=>e.id)));var r=this.ShExRVisitor(t);return"start"in e&&(e.start=r.visitShapeExpr(e.start)),"shapes"in e&&(e.shapes=e.shapes.map(e=>r.keepShapeExpr(e))),r.cleanIds(),e},valGrep:function(e,t,r){var n=[];for(var i in e){var s=e[i];"object"==typeof s&&("type"in s&&s.type===t&&n.push(r(s)),n.push.apply(n,this.valGrep(s,t,r)))}return n},n3jsToTurtle:function(e){return this.valGrep(e,"TestedTriple",function(e){return["subject","predicate","object"].map(t=>(function(e){return"object"==typeof e?'"'+e.value+'"'+("type"in e?"^^<"+e.type+">":"language"in e?"@"+e.language:""):r.isIRI(e)?"<"+e+">":r.isBlank(e)?e:"???"})(e[t])).join(" ")+" ."})},valToN3js:function(e){return this.valGrep(e,"TestedTriple",function(e){var t=JSON.parse(JSON.stringify(e));return"object"==typeof e.object&&(t.object='"'+e.object.value+'"'+("type"in e.object?"^^"+e.object.type:"language"in e.object?"@"+e.object.language:"")),t})},n3jsToTurtle:function(e){return e.map(function(e){return["subject","predicate","object"].map(t=>(function(e){if(r.isIRI(e))return"<"+e+">";if(r.isBlank(e))return e;var t=r.getLiteralType(e);return t&&"http://www.w3.org/2001/XMLSchema#string"!==t?'"'+r.getLiteralValue(e)+'"^^<'+t+">":e})(e[t])).join(" ")+" ."})},canonicalize:function(e,t){var r=JSON.parse(JSON.stringify(e));delete r.prefixes,delete r.base;var n=f.Visitor(),i=[],s=n.visitInclusion,a=n.visitExpression;return n.visitInclusion=function(t){return-1===i.indexOf(t.include)&&"productions"in e&&t.include in e.productions?(i.push(t.include),a.call(n,e.productions[t.include])):s.call(n,t)},n.visitExpression=function(t){return"id"in t?-1===i.indexOf(t.id)?(i.push(t.id),a.call(n,e.productions[t.id])):{type:"Inclusion",include:t.id}:a.call(n,t)},t&&(n.visitIRI=function(e){return e.replace(t,"")},"imports"in r&&(r.imports=n.visitImports(r.imports))),"shapes"in r&&Object.keys(r.shapes).sort().forEach(e=>{"extra"in r.shapes[e]&&r.shapes[e].extra.sort(),r.shapes[e]=n.visitShapeExpr(r.shapes[e])}),r},BiDiClosure:function(){return{needs:{},neededBy:{},inCycle:[],test:function(){function e(e,t){var r=JSON.stringify(e),n=JSON.stringify(t);if(r!==n)throw Error(r+" !== "+n)}this.add(2,3),e(this.needs,{2:[3]}),e(this.neededBy,{3:[2]}),this.add(1,2),e(this.needs,{1:[2,3],2:[3]}),e(this.neededBy,{3:[2,1],2:[1]}),this.add(1,3),e(this.needs,{1:[2,3],2:[3]}),e(this.neededBy,{3:[2,1],2:[1]}),this.add(3,4),e(this.needs,{1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{3:[2,1],2:[1],4:[3,2,1]}),this.add(6,7),e(this.needs,{6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6],3:[2,1],2:[1],4:[3,2,1]}),this.add(5,6),e(this.needs,{5:[6,7],6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],3:[2,1],2:[1],4:[3,2,1]}),this.add(5,7),e(this.needs,{5:[6,7],6:[7],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],3:[2,1],2:[1],4:[3,2,1]}),this.add(7,8),e(this.needs,{5:[6,7,8],6:[7,8],7:[8],1:[2,3,4],2:[3,4],3:[4]}),e(this.neededBy,{7:[6,5],6:[5],8:[7,6,5],3:[2,1],2:[1],4:[3,2,1]}),this.add(4,5),e(this.needs,{1:[2,3,4,5,6,7,8],2:[3,4,5,6,7,8],3:[4,5,6,7,8],4:[5,6,7,8],5:[6,7,8],6:[7,8],7:[8]}),e(this.neededBy,{2:[1],3:[2,1],4:[3,2,1],5:[4,3,2,1],6:[5,4,3,2,1],7:[6,5,4,3,2,1],8:[7,6,5,4,3,2,1]})},add:function(e,t,r){var n=this;e in n.needs||(n.needs[e]=[]),t in n.neededBy||(n.neededBy[t]=[]),n.needs[e]=n.needs[e].concat([t],n.needs[t]).filter(function(e,t,r){return void 0!==e&&r.indexOf(e)===t}),n.neededBy[t]=n.neededBy[t].concat([e],n.neededBy[e]).filter(function(e,t,r){return void 0!==e&&r.indexOf(e)===t}),e in this.neededBy&&this.neededBy[e].forEach(function(e){n.needs[e]=n.needs[e].concat([t],n.needs[t]).filter(function(e,t,r){return void 0!==e&&r.indexOf(e)===t})}),t in this.needs&&this.needs[t].forEach(function(t){n.neededBy[t]=n.neededBy[t].concat([e],n.neededBy[e]).filter(function(e,t,r){return void 0!==e&&r.indexOf(e)===t})}),-1!==n.needs[e].indexOf(e)&&(n.inCycle=n.inCycle.concat(n.needs[e]))},trim:function(){function e(e){for(var t=e.length-1;t>-1;--t)e.indexOf(e[t])<t&&e.splice(t,t+1)}for(k in this.needs)e(this.needs[k]);for(k in this.neededBy)e(this.neededBy[k])},foundIn:{},addIn:function(e,t){this.foundIn[e]=t}}},nestShapes:function(e,t={}){var r=this;"no"in t||(t.no=!1);let n=Object.keys(e.shapes||[]),i={};n.forEach(t=>{let n=e.shapes[t];if(a(t,null),"Shape"===(n=r.skipDecl(n)).type)"extends"in n&&n.extends.forEach(e=>a(e,n)),"expression"in n&&(r.simpleTripleConstraints(n)||[]).forEach(e=>{a(r.getValueType(e.valueExpr,!0),{type:"tc",shapeLabel:t,tc:e})});else if("NodeConstraint"!==n.type)throw Error("nestShapes currently only supports Shapes and NodeConstraints")});let s=Object.keys(i).filter(t=>1===i[t].length&&"tc"===i[t][0].type&&"Shape"===r.skipDecl(e.shapes[t]).type).reduce((e,t)=>(e[t]={referrer:i[t][0].shapeLabel,predicate:i[t][0].tc.predicate},e),{});if(!t.no){let r={};if(t.rename){"transform"in t||(t.transform=function(){let e=n.reduce((e,t,r)=>(e[t]="_:transformed"+r,e),{});return function(t,r){return e[t]}}()),Object.keys(s).forEach(a=>{let o=e.shapes[a],c=t.transform(a,o);if(r[a]=c,n[n.indexOf(a)]=c,s[c]=s[a],s[c].was=a,delete s[a],e.shapes[c]=e.shapes[a],delete e.shapes[a],1!==i[a].length)throw Error("assertion: "+a+" doesn't have one reference: ["+i[a]+"]");let u=i[a][0];if("tc"!==u.type)throw"Shape"===u.type?Error("assertion: rename not implemented for Shape: "+u):Error("assertion: "+u.type+" not TripleConstraint or Shape");if("ShapeRef"!==u.tc.valueExpr.type)throw Error("assertion: rename not implemented for TripleConstraint expr: "+u.tc.valueExpr);u.tc.valueExpr.reference=c}),Object.keys(s).forEach(e=>{let t=s[e];t.referrer in r&&(t.newReferrer=r[t.referrer])});let a={};n.forEach(t=>a[t]=e.shapes[t]),e.shapes=a}else Object.keys(s).forEach(t=>{i[t][0].tc.valueExpr=e.shapes[t].shapeExpr,delete e.shapes[t]})}return s;function a(e,t){e in i||(i[e]=[]),t&&i[e].push(t)}},getPredicateUsage:function(e,t={}){var r=this;let i=n.create();Object.keys(e.shapes).forEach(t=>{let n=r.skipDecl(e.shapes[t]);"Shape"===n.type&&(n.extends||[]).forEach(e=>i.add(e,t))}),Object.keys(e.shapes).forEach(e=>{e in i.parents||(i.parents[e]=[])});let s={};return Object.keys(e.shapes).forEach(n=>{let a=r.skipDecl(e.shapes[n]);if("Shape"===a.type){(r.simpleTripleConstraints(a)||[]).forEach(e=>{let a=r.getValueType(e.valueExpr);if(e.predicate in s){s[e.predicate].uses.push(n);let r=s[e.predicate].commonType;if("object"==typeof r||null===r)t[e.predicate].references.push({shapeLabel:n,newType:a});else if("object"==typeof a)s[e.predicate].commonType=null,t[e.predicate]={shapeLabel:n,predicate:e.predicate,curType:r,newType:a,references:[]};else if(r===a);else if(-1!==i.parents[r].indexOf(a))s[e.predicate].polymorphic=!0;else{let o=i.parents[a].indexOf(r);if(-1===o){let o=i.parents[r].filter(e=>-1!==i.parents[a].indexOf(e));0===o.length?(t[e.predicate]={shapeLabel:n,predicate:e.predicate,curType:r,newType:a,references:[]},s[e.predicate].commonType=null):(s[e.predicate].commonType=o[0],s[e.predicate].polymorphic=!0)}else s[e.predicate].commonType=i.parents[a][o],s[e.predicate].polymorphic=!0}}else s[e.predicate]={uses:[n],commonType:a,polymorphic:!1},"object"==typeof a&&(t[e.predicate]={shapeLabel:n,predicate:e.predicate,newType:a,references:[]})})}}),s},simpleTripleConstraints:function(e){if(!("expression"in e))return[];if("TripleConstraint"===e.expression.type)return[e.expression];if("EachOf"===e.expression.type&&!e.expression.expressions.find(e=>"TripleConstraint"!==e.type))return e.expression.expressions;throw Error("can't (yet) express "+JSON.stringify(e))},skipDecl:function(e){return"ShapeDecl"===e.type?e.shapeExpr:e},getValueType:function(e){return"string"==typeof e?e:e.reference?e.reference:"iri"===e.nodeKind?o.Thing:e.datatype?e.datatype:e},getDependencies:function(e,t){return t=t||this.BiDiClosure(),Object.keys(e.shapes||[]).forEach(function(r){function n(e,i){if("ShapeOr"===e.type||"ShapeAnd"===e.type)e.shapeExprs.forEach(function(e){n(e,i)});else if("ShapeNot"===e.type)n(e.shapeExpr,1^i);else if("Shape"===e.type)!function(e,i){e.inherit&&e.inherit.length>0&&e.inherit.forEach(function(e){t.add(r,e)});e.expression&&function e(i,s){function a(t,r){t.forEach(function(t){e(t,r)})}"id"in i&&t.addIn(i.id,r);if("TripleConstraint"===i.type)!function(e,i){e.valueExpr&&n(e.valueExpr,i);if(i&&-1!==t.inCycle.indexOf(r))throw Error("Structural error: "+r+" appears in negated cycle")}(i,s);else if("OneOf"===i.type||"EachOf"===i.type)!function a(e,i){e.forEach(function(e){!function e(i,s){function a(t,r){t.forEach(function(t){e(t,r)})}"id"in i&&t.addIn(i.id,r);if("TripleConstraint"===i.type)!function(e,i){e.valueExpr&&n(e.valueExpr,i);if(i&&-1!==t.inCycle.indexOf(r))throw Error("Structural error: "+r+" appears in negated cycle")}(i,s);else if("OneOf"===i.type||"EachOf"===i.type)a(i.expressions);else{if("Inclusion"!==i.type)throw Error("expected {TripleConstraint,OneOf,EachOf,Inclusion} in "+i);t.add(r,i.include)}}(e,i)})}(i.expressions);else{if("Inclusion"!==i.type)throw Error("expected {TripleConstraint,OneOf,EachOf,Inclusion} in "+i);t.add(r,i.include)}}(e.expression,i)}(e,i);else if("NodeConstraint"===e.type);else if("ShapeRef"===e.type)t.add(r,e.reference);else if("ShapeExternal"!==e.type)throw Error("expected Shape{And,Or,Ref,External} or NodeConstraint in "+util.inspect(e))}n(e.shapes[r],0)}),t},partition:function(e,t,r,n){t=t instanceof Array?t:[t],r=r||this.getDependencies(e),n=n||function(e,t){throw new Error("Error: can't find shape "+(t?t+" dependency "+e:e))};var i={};for(var s in e)i[s]="shapes"===s?{}:e[s];return t.forEach(function(t){t in e.shapes?(i.shapes[t]=e.shapes[t],t in r.needs&&r.needs[t].forEach(function(s){if(s in e.shapes)i.shapes[s]=e.shapes[s];else if(s in e.productions){var a=r.foundIn[s];i.shapes[a]=e.shapes[a],i.productions[s]=e.productions[s]}else n(s,t)})):n(t)}),i},flatten:function(e,t,r){return this.Visitor().visitSchema(e)},emptySchema:function(){return{type:"Schema"}},merge:function(e,t,r,n){var i,s=n?e:this.emptySchema();return"productions"in e&&(s.productions=e.productions),"productions"in t&&("productions"in e&&!r||(s.productions=t.productions)),"base"in e&&(s.base=e.base),"base"in t&&("base"in e&&!r||(s.base=t.base)),i="prefixes",Object.keys(e[i]||{}).forEach(function(t){i in s||(s[i]={}),s[i][t]=e[i][t]}),Object.keys(t[i]||{}).forEach(function(n){i in e&&n in e[i]&&!r||(i in s||(s[i]={}),s[i][n]=t[i][n])}),"imports"in t&&("imports"in e&&!r||(s.imports=t.imports)),"startActs"in e&&(s.startActs=e.startActs),"startActs"in t&&("startActs"in e&&!r||(s.startActs=t.startActs)),"start"in e&&(s.start=e.start),"start"in t&&("start"in e&&!r||(s.start=t.start)),Object.keys(e.shapes||{}).forEach(function(t){"shapes"in s||(s.shapes={}),s.shapes[t]=e.shapes[t]}),Object.keys(t.shapes||{}).forEach(function(n){"shapes"in e&&n in e.shapes&&!r||("shapes"in s||(s.shapes={}),s.shapes[n]=t.shapes[n])}),s},absolutizeResults:function(e,t){function n(e,n){-1!==["shape","reference","node","subject","predicate","object"].indexOf(e)&&r.isIRI(n[e])&&(n[e]=r.resolveRelativeIRI(t,n[e]))}return function e(t){Object.keys(t).forEach(function(r){"object"==typeof t[r]&&e(t[r]),n&&n(r,t)})}(e),e},validateSchema:function(e){var t=this.Visitor(),r=currentExtra=null,i=!1,s=!1,a=t.visitShape,o=n.create(),c=n.create();t.visitShape=function(e,r){var n=currentExtra;currentExtra=e.extra;var i=a.call(t,e,r);return currentExtra=n,i};var u=t.visitShapeNot;t.visitShapeNot=function(e,r){var n=i;i^=!0;var s=u.call(t,e,r);return i=n,s};var p=t.visitTripleConstraint;t.visitTripleConstraint=function(e){var r=i;currentExtra&&-1!==currentExtra.indexOf(e.predicate)&&(i^=!0),s=!0;var n=p.call(t,e);return s=!1,i=r,n};var l=t.visitShapeRef;t.visitShapeRef=function(n){if(!(n.reference in e.shapes))throw Error("Structural error: reference to "+JSON.stringify(n)+" not found in schema shape expressions:\n"+h(e.shapes)+".");if(!s&&n.reference===r)throw Error("Structural error: circular reference to "+r+".");return(i?o:c).add(r,n.reference),l.call(t,n)};var f=t.visitInclusion;t.visitInclusion=function(r){if(!("productions"in e&&e.productions[r.include]))throw Error("Structural error: included shape "+r.include+" not found in schema triple expressions:\n"+h(e.productions)+".");return f.call(t,r)},Object.keys(e.shapes||[]).forEach(function(n){r=n,t.visitShapeExpr(e.shapes[n],n)});let d=Object.keys(o.children).filter(e=>o.children[e].filter(t=>t in o.children&&-1!==o.children[t].indexOf(e)||t in c.children&&-1!==c.children[t].indexOf(e)).length>0);if(d.length)throw Error("Structural error: circular negative dependencies on "+d.join(",")+".");function h(e){return e?Object.keys(e).map(e=>"_:"===e.substr(0,2)?e:"<"+e+">").join("\n        "):"- none defined -"}},isWellDefined:function(e){return this.validateSchema(e),e},walkVal:function(e,t){var r=this;if("NodeTest"===e.type)return null;if("ShapeTest"===e.type)return"solution"in e?r.walkVal(e.solution,t):null;if("ShapeOrResults"===e.type)return r.walkVal(e.solution,t);if("EachOfSolutions"===e.type||"OneOfSolutions"===e.type)return e.solutions.reduce((e,n)=>(n.expressions.forEach(n=>{var i=r.walkVal(n,t);i&&Object.keys(i).forEach(t=>{e[t]=t in e?e[t].concat(i[t]):i[t]})}),e),{});if("OneOfSolutions"===e.type)return e.solutions.reduce((e,n)=>(Object.assign(e,r.walkVal(n,t)),e),{});if("TripleConstraintSolutions"===e.type){if("solutions"in e){var n={},i=[];return n[e.predicate]=i,e.solutions.forEach(e=>{var n=[];if(function e(n){if(!n)return!1;if(n.node===s.nil)return!0;if("solution"in n&&"solutions"in n.solution&&1===n.solution.solutions.length&&"expressions"in n.solution.solutions[0]&&2===n.solution.solutions[0].expressions.length&&"predicate"in n.solution.solutions[0].expressions[0]&&n.solution.solutions[0].expressions[0].predicate===s.first&&n.solution.solutions[0].expressions[1].predicate===s.rest){var a=n.solution.solutions[0].expressions,o=a[0],c=a[1].solutions[0],u=o.solutions[0],p=t(u);if("referenced"in u){var l=r.walkVal(u.referenced,t);l&&(p.nested=l)}return i.push(p),c.object===s.nil||e(c.referenced)}}(e.referenced))i=i.concat(n);else{var a=t(e);if("referenced"in e){var o=r.walkVal(e.referenced,t);o&&(a.nested=o)}i.push(a)}}),i.length?n:null}return null}if("Recursion"===e.type)return null;throw Error("unknown shapeExpression type in "+JSON.stringify(e))},valToValues:function(e){return this.walkVal(e,function(e){return{ldterm:e.object}})},valToExtension:function(e,t){return function e(r){var n=[],i={};function s(e){if(null===i)return e;if(e.constructor===Array)return i=null,e;for(a in e){if(a in i)return i=null,e;i[a]=e[a]}return e}for(var a in r)if("extensions"===a)r[a]&&n.push(s(r[a][t]));else if("nested"===a){var o=e(r[a]);o.constructor===Array?o.forEach(s):s(o),n=n.concat(o)}else n.push(s(e(r[a])));return 1===n.length?n[0]:i||n}(this.walkVal(e,function(e){return{extensions:e.extensions}}))},valuesToSchema:function(e){var t=e;if(e[s.type][0].ldterm===i.Schema){var r={"@context":"http://www.w3.org/ns/shex.jsonld",type:"Schema"};i.startActs in t&&(r.startActs=t[i.startActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),i.imports in t&&(r.imports=t[i.imports].map(e=>e.ldterm)),e[i.start]&&(r.start=p({id:e[i.start][0].ldterm},o(e[i.start][0].nested)));var n=e[i.shapes];return n&&(r.shapes=n.map(e=>p({id:e.ldterm},o(e.nested)))),r}throw Error("unknown schema type in "+JSON.stringify(e));function a(e,t,r){var n=e[s.type][0].ldterm.substr(i._namespace.length),a=t[n];if(!a)return c;if(a.nary)return(o={type:n})[a.prop]=e[i[a.prop]].map(e=>u(e)),o;var o={type:n};return a.prop&&(o[a.prop]=u(e[i[a.prop]][0])),o;function u(e){return a.expr&&"nested"in e?p({id:e.ldterm},r(e.nested)):e.ldterm}}function o(e){if((r=a(e,{ShapeAnd:{nary:!0,expr:!0,prop:"shapeExprs"},ShapeOr:{nary:!0,expr:!0,prop:"shapeExprs"},ShapeNot:{nary:!1,expr:!0,prop:"shapeExpr"},ShapeRef:{nary:!1,expr:!1,prop:"reference"},ShapeExternal:{nary:!1,expr:!1,prop:null}},o))!==c)return r;var t=e[s.type][0].ldterm;if(t===i.Shape){var r={type:"Shape"};return["closed"].forEach(t=>{i[t]in e&&(r[t]=!!e[i[t]][0].ldterm.value)}),i.extra in e&&(r.extra=e[i.extra].map(e=>e.ldterm)),i.expression in e&&(r.expression="nested"in e[i.expression][0]?p({id:e[i.expression][0].ldterm},l(e[i.expression][0].nested)):e[i.expression][0].ldterm),i.annotation in e&&(r.annotations=e[i.annotation].map(e=>({type:"Annotation",predicate:e.nested[i.predicate][0].ldterm,object:e.nested[i.object][0].ldterm}))),i.semActs in e&&(r.semActs=e[i.semActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),r}if(t===i.NodeConstraint){r={type:"NodeConstraint"};return i.values in e&&(r.values=e[i.values].map(e=>(function e(t,r){if("nested"in t){var n=t.nested[s.type][0].ldterm;if(-1!==[i.IriStem,i.LiteralStem,i.LanguageStem].indexOf(n)){var a=t.nested[i.stem][0].ldterm.value;return{type:n.substr(i._namespace.length),stem:a}}if(-1!==[i.Language].indexOf(n))return{type:"Language",languageTag:t.nested[i.languageTag][0].ldterm.value};if(-1!==[i.IriStemRange,i.LiteralStemRange,i.LanguageStemRange].indexOf(n)){var o=t.nested[i.stem][0],c=o;"object"==typeof o&&("object"==typeof o.ldterm?c=o.ldterm:o.ldterm.startsWith("_:")&&(c={type:"Wildcard"}));var u={type:n.substr(i._namespace.length),stem:"Wildcard"!==c.type?c.value:c};return i.exclusion in t.nested&&(u.exclusions=t.nested[i.exclusion].map(t=>e(t,n!==i.IriStemRange))),u}throw Error("unknown objectValue type in "+JSON.stringify(t))}return r?t.ldterm.value:t.ldterm})(e))),i.nodeKind in e&&(r.nodeKind=e[i.nodeKind][0].ldterm.substr(i._namespace.length)),["length","minlength","maxlength","mininclusive","maxinclusive","minexclusive","maxexclusive","totaldigits","fractiondigits"].forEach(t=>{i[t]in e&&(r[t]=parseFloat(e[i[t]][0].ldterm.value))}),i.pattern in e&&(r.pattern=e[i.pattern][0].ldterm.value),i.flags in e&&(r.flags=e[i.flags][0].ldterm.value),i.datatype in e&&(r.datatype=e[i.datatype][0].ldterm),r}throw Error("unknown shapeExpr type in "+JSON.stringify(e))}function l(e){if((t=a(e,{EachOf:{nary:!0,expr:!0,prop:"expressions"},OneOf:{nary:!0,expr:!0,prop:"expressions"},Inclusion:{nary:!1,expr:!1,prop:"include"}},l))!==c)return f(e,t),t;if(e[s.type][0].ldterm===i.TripleConstraint){var t={type:"TripleConstraint",predicate:e[i.predicate][0].ldterm};return["inverse"].forEach(r=>{i[r]in e&&(t[r]=!!e[i[r]][0].ldterm.value)}),i.valueExpr in e&&(t.valueExpr=p({id:e[i.valueExpr][0].ldterm},"nested"in e[i.valueExpr][0]?o(e[i.valueExpr][0].nested):{})),f(e,t),t}throw Error("unknown tripleExpr type in "+JSON.stringify(e))}function f(e,t){return i.min in e&&(t.min=parseInt(e[i.min][0].ldterm.value)),i.max in e&&(t.max=parseInt(e[i.max][0].ldterm.value),isNaN(t.max)&&(t.max=u)),i.annotation in e&&(t.annotations=e[i.annotation].map(e=>({type:"Annotation",predicate:e.nested[i.predicate][0].ldterm,object:e.nested[i.object][0].ldterm}))),i.semActs in e&&(t.semActs=e[i.semActs].map(e=>{var t={type:"SemAct",name:e.nested[i.name][0].ldterm};return i.code in e.nested&&(t.code=e.nested[i.code][0].ldterm.value),t})),t}},valToSimple:function(e){var t,r=this;function n(e){return e.reduce((e,t)=>(Object.keys(t).forEach(r=>{e[r]=r in e?Array.from(new Set(e[r].concat(t[r]))):t[r]}),e),{})}if("TripleConstraintSolutions"===e.type)return"solutions"in e?e.solutions.reduce((e,t)=>{if(!("referenced"in t))return{};var i={};return function e(t){if(!t)return!1;if(t.node===s.nil)return!0;if("solution"in t&&"solutions"in t.solution&&1===t.solution.solutions.length&&"expressions"in t.solution.solutions[0]&&2===t.solution.solutions[0].expressions.length&&"predicate"in t.solution.solutions[0].expressions[0]&&t.solution.solutions[0].expressions[0].predicate===s.first&&t.solution.solutions[0].expressions[1].predicate===s.rest){var a=t.solution.solutions[0].expressions,o=a[0],c=a[1].solutions[0],u=o.solutions[0],p={ldterm:u.object};if("referenced"in u){var l=r.valToSimple(u.referenced);l&&(p.nested=l)}return i=n(i),c.object===s.nil||e(c.referenced)}}(t.referenced)?n(e):n(e,r.valToSimple(t.referenced))},[]):[];if(-1!==["TripleConstraintSolutions"].indexOf(e.type))return{};if("NodeTest"===e.type)return(t={})[d(e.node)]=[e.shape],t;if("ShapeTest"===e.type)return(t={})[d(e.node)]=[e.shape],"solution"in e?n([t].concat(r.valToSimple(e.solution))):t;if("Recursion"===e.type)return{};if("solutions"in e)return n(e.solutions.map(e=>r.valToSimple(e)));if("expressions"in e)return n(e.expressions.map(e=>r.valToSimple(e)));throw Error("unknown shapeExpression type in "+JSON.stringify(e))},simpleToShapeMap:function(e){return Object.keys(e).reduce((t,r)=>(e[r].forEach(e=>{t.push({node:r,shape:e})}),t),[])},absolutizeShapeMap:function(e,t){return e.map(e=>Object.assign(e,{node:r.resolveRelativeIRI(t,e.node),shape:r.resolveRelativeIRI(t,e.shape)}))},errsToSimple:function(r,n,i){var s=this;if("FailureList"===r.type)return r.errors.reduce((e,t)=>e.concat(s.errsToSimple(t)),[]);if("Failure"===r.type)return["validating "+r.node+" as "+r.shape+":"].concat(function e(t){return t.reduce(function(t,r){var n=Object.keys(r);return t.concat(1===n.length&&"errors"===n[0]?e(r.errors):r)},[])}(r.errors).reduce((e,t)=>{var r=s.errsToSimple(t).map(e=>"  "+e);return e.length>0?e.concat(["  OR"]).concat(r):r.map(e=>"  "+e)},[]));if("TypeMismatch"===r.type){var a=r.errors.constructor===Array?r.errors.reduce((e,t)=>e.concat(("string"==typeof t?[t]:s.errsToSimple(t)).map(e=>"  "+e)),[]):"  "+("string"==typeof e?[r.errors]:s.errsToSimple(r.errors));return["validating "+d(r.triple.object)+":"].concat(a)}if("ShapeAndFailure"===r.type)return r.errors.constructor===Array?r.errors.reduce((e,t)=>e.concat(("string"==typeof t?[t]:s.errsToSimple(t)).map(e=>"  "+e)),[]):"  "+("string"==typeof e?[r.errors]:s.errsToSimple(r.errors));if("ShapeOrFailure"===r.type)return r.errors.constructor===Array?r.errors.reduce((e,t)=>e.concat(" OR "+("string"==typeof t?[t]:s.errsToSimple(t))),[]):" OR "+("string"==typeof e?[r.errors]:s.errsToSimple(r.errors));if("ShapeNotFailure"===r.type)return["Node "+r.errors.node+" expected to NOT pass "+r.errors.shape];if("ExcessTripleViolation"===r.type)return["validating "+d(r.triple.object)+": exceeds cardinality"];if("ClosedShapeViolation"===r.type)return["ClosedShapeError: unexpected: {"].concat(r.unexpectedTriples.map(e=>"  "+e.subject+" "+e.predicate+" "+d(e.object)+" .")).concat(["}"]);if("NodeConstraintViolation"===r.type){var o,c=t("../lib/ShExWriter")();return c._write(c._writeNodeConstraint(r.shapeExpr).join("")),c.end((e,t)=>{o=t}),["NodeConstraintError: expected to match "+o]}if("MissingProperty"===r.type)return["Missing property: "+r.property];if("NegatedProperty"===r.type)return["Unexpected property: "+r.property];if(r.constructor===Array)return r.reduce((e,t)=>{var r=s.errsToSimple(t).map(e=>"  "+e);return e.length?e.concat(["AND"]).concat(r):r},[]);throw Error("unknown shapeExpression type in "+JSON.stringify(r))},resolveRelativeIRI:r.resolveRelativeIRI,resolvePrefixedIRI:function(e,t){var r=e.indexOf(":");if(-1===r)return null;var n=t[e.substr(0,r)];return void 0===n?null:n+e.substr(r+1)},parsePassedNode:function(e,t,n,i,s){if(void 0===e||0===e.length)return i&&i(t.base)?t.base:n?n():this.NotSupplied;if("_"===e[0]&&":"===e[1])return e;if('"'===e[0]){var a=e.match(/^"((?:[^"\\]|\\")*)"(?:@(.+)|\^\^(?:<(.*)>|([^:]*):(.*)))?$/);if(!a)throw Error("malformed literal: "+e);var o=a[1],c=a[2],u=a[3],p=a[4],l=a[5],f='"'+o+'"';if(void 0!==c)return f+"@"+c;if(void 0!==p){if(!(p in t.prefixes))throw Error("error parsing node "+e+' no prefix for "'+p+'"');return f+"^^"+t.prefixes[p]+l}return void 0!==u?f+"^^"+r.resolveRelativeIRI(t.base,u):f}if(!t)return i(e)?e:this.UnknownIRI;var d="<"===e[0]&&">"===e[e.length-1];d&&(e=e.substr(1,e.length-2));var h=r.resolveRelativeIRI(t.base||"",e);if(i(h))return h;if(!d){var v=this.resolvePrefixedIRI(e,t.prefixes);if(null!==v&&i(v))return v}return s?s(h):this.UnknownIRI},executeQueryPromise:function(e,t){var r=t+"?query="+encodeURIComponent(e);return fetch(r,{headers:{Accept:"application/sparql-results+json"}}).then(e=>e.json()).then(e=>{var t=e.head.vars;return e.results.bindings.map(e=>t.map(t=>{var r=e[t];switch(r.type){case"uri":return r.value;case"bnode":return"_:"+r.value;case"literal":var n=r.datatype,i=r["xml:lang"];return'"'+r.value+'"'+(n?"^^"+n:i?"@"+i:"");default:throw"unknown XML results type: "+r.prop("tagName")}return e[t]}))})},executeQuery:function(e,r){var n,i=r+"?query="+encodeURIComponent(e);if(t("sync-request")){n=t("sync-request")("GET",i,{headers:{Accept:"application/sparql-results+json"}}).getBody().toString("utf-8")}else{var s=new XMLHttpRequest;s.open("GET",i,!1),s.setRequestHeader("Accept","application/sparql-results+json"),s.send(),n=s.responseText}var a,o=(a=JSON.parse(n)).head.vars;return a.results.bindings.map(e=>o.map(t=>{var r=e[t];switch(r.type){case"uri":return r.value;case"bnode":return"_:"+r.value;case"literal":var n=r.datatype,i=r["xml:lang"];return'"'+r.value+'"'+(n?"^^"+n:i?"@"+i:"");default:throw"unknown XML results type: "+r.prop("tagName")}return e[t]}))},makeN3DB:function(e,t){return{getNeighborhood:function(n,i){var s;t&&(s=new Date,t.start(!1,n,i));var a=e.getQuads(n,null,null,null).map(r.internalTriple);if(t){var o=new Date;t.end(a,o-s),s=o}t&&t.start(!0,n,i);var c=e.getQuads(null,null,n,null).map(r.internalTriple);return t&&t.end(c,new Date-s),{outgoing:a,incoming:c}},getSubjects:function(){return e.getSubjects().map(r.internalTerm)},getPredicates:function(){return e.getPredicates().map(r.internalTerm)},getObjects:function(){return e.getObjects().map(r.internalTerm)},getQuads:function(){return e.getQuads.apply(e,arguments).map(r.internalTriple)},get size(){return e.size}}},makeQueryDB:function(e,t){var r=this;function n(t,n,i){return r.executeQuery(t,e).map(e=>n?{subject:n,predicate:e[0],object:e[1]}:{subject:e[0],predicate:e[1],object:i})}return{getNeighborhood:function(e,i,s){var a,o,c,u,p=(o=s.expression,c=r.Visitor(),u={out:[],inc:[]},c.visitTripleConstraint=function(e){return u[e.inverse?"inc":"out"].push(e),e},o&&c.visitExpression(o),u),l=p.out.map(e=>e.predicate);l=l.filter((e,t)=>l.lastIndexOf(e)===t),t&&(a=new Date,t.start(!1,e,i));var f=p.out.length>0||s.closed?n(s.closed?`SELECT ?p ?o { <${e}> ?p ?o }`:"SELECT ?p ?o {\n"+l.map(t=>`  {<${e}> <${t}> ?o BIND(<${t}> AS ?p)}`).join(" UNION\n")+"\n}",e,null):[];if(t){var d=new Date;t.end(f,d-a),a=d}t&&t.start(!0,e,i);var h=p.inc.length>0?n(`SELECT ?s ?p { ?s ?p <${e}> }`,null,e):[];return t&&t.end(h,new Date-a),{outgoing:f,incoming:h}},getQuads:function(e,t,r,i){return n("SELECT "+[e?"":"?s",t?"":"?p",r?"":"?o","{",e||"?s",t||"?s",r||"?s","}"].join(" "),e,r)},getSubjects:function(){return["!Query DB can't index subjects"]},getPredicates:function(){return["!Query DB can't index predicates"]},getObjects:function(){return["!Query DB can't index objects"]},get size(){}}},NotSupplied:"-- not supplied --",UnknownIRI:"-- not found --",_expect:function(e,t,r){t in e||this._error("expected "+JSON.stringify(e)+" to have a ."+t),arguments.length>2&&e[t]!==r&&this._error("expected "+e[e]+" to equal ."+r)},_error:function(e){throw new Error(e)},unescapeText:function(e,t){try{return e=e.replace(/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\(.)/g,function(e,r,n,i){var s;if(r){if(s=parseInt(r,16),isNaN(s))throw new Error;return String.fromCharCode(s)}if(n){if(s=parseInt(n,16),isNaN(s))throw new Error;return s<65535?String.fromCharCode(s):String.fromCharCode(55296+((s-=65536)>>10),56320+(1023&s))}var a=t[i];if(!a)throw new Error("no replacement found for '"+i+"'");return a})}catch(e){return console.warn(e),""}}};function d(e){if("object"!=typeof e)return e;var t='"'+e.value+'"';return"language"in e?t+"@"+e.language:"type"in e?t+"^^"+e.type:t}function h(e,t){for(var r in f)t?e.prototype[r]=v(f[r]):e[r]=f[r];return e}function v(e){return function(t){return e(this,t)}}return h(h)}();void 0!==t&&void 0!==n&&(r.exports=i)},{"../lib/ShExWriter":16,"./RdfTerm":13,"hierarchy-closure":19,"sync-request":9}],15:[function(e,t,r){(function(n){var i=function(){var t=-1,r={term:"START"},i="VERBOSE"in n.env,s=e("./RdfTerm");function a(e){return s.isIRI(e)?e:s.isLiteral(e)?s.getLiteralValue(e):e.substr(2)}var o="http://www.w3.org/2001/XMLSchema#",c=[o+"integer",o+"nonPositiveInteger",o+"negativeInteger",o+"long",o+"int",o+"short",o+"byte",o+"nonNegativeInteger",o+"unsignedLong",o+"unsignedInt",o+"unsignedShort",o+"unsignedByte",o+"positiveInteger"],u=[o+"decimal"].concat(c),p=[o+"float",o+"double"].concat(u),l={};l[o+"integer"]=function(e,t){return e.match(/^[+-]?[0-9]+$/)||t("illegal integer value '"+e+"'"),parseInt(e)},l[o+"decimal"]=function(e,t){return e.match(/^[+-]?(?:[0-9]*\.[0-9]+|[0-9]+)$/)||t("illegal decimal value '"+e+"'"),parseFloat(e)};const f=/^[+\-]?(?:[0-9]+(?:\.[0-9]*)?|\.[0-9]+)(?:[eE][+\-]?[0-9]+)?$/;l[o+"float"]=function(e,t){return"NaN"===e?NaN:"INF"===e?1/0:"-INF"===e?-1/0:(e.match(f)||t("illegal float value '"+e+"'"),parseFloat(e))},l[o+"double"]=function(e,t){return"NaN"===e?NaN:"INF"===e?1/0:"-INF"===e?-1/0:(e.match(f)||t("illegal double value '"+e+"'"),Number(e))},testRange=function(e,t,r){var n={integer:{min:-1/0,max:1/0},decimal:{min:-1/0,max:1/0},float:{min:-1/0,max:1/0},double:{min:-1/0,max:1/0},nonPositiveInteger:{min:-1/0,max:0},negativeInteger:{min:-1/0,max:-1},long:{min:-0x8000000000000000,max:0x8000000000000000},int:{min:-2147483648,max:2147483647},short:{min:-32768,max:32767},byte:{min:-128,max:127},nonNegativeInteger:{min:0,max:1/0},unsignedLong:{min:0,max:0x10000000000000000},unsignedInt:{min:0,max:4294967295},unsignedShort:{min:0,max:65535},unsignedByte:{min:0,max:255},positiveInteger:{min:1,max:1/0}}[t.substr(o.length)];if(!n)throw Error("unexpected datatype: "+t);e<n.min?r('"'+e+'"^^<'+t+"> is less than the min:",n.min):e>n.max&&r('"'+e+'"^^<'+t+"> is greater than the max:",n.min)};var d={length:function(e,t){return e.length===t},minlength:function(e,t){return e.length>=t},maxlength:function(e,t){return e.length<=t}},h={mininclusive:function(e,t){return e>=t},minexclusive:function(e,t){return e>t},maxinclusive:function(e,t){return e<=t},maxexclusive:function(e,t){return e<t}},v={totaldigits:function(e,t){var r=e.match(/[0-9]/g);return r&&r.length<=t},fractiondigits:function(e,t){var r=e.match(/^[+-]?[0-9]*\.?([0-9]*)$/);return r&&r[1].length<=t}};function m(e){if('"'!==e[0])return e;var t={value:s.getLiteralValue(e)},r=s.getLiteralType(e);r&&"http://www.w3.org/2001/XMLSchema#string"!==r&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==r&&(t.type=r);var n=s.getLiteralLanguage(e);return n&&(t.language=n),t}function y(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}function g(e,r,n){function i(){this.type="Epsilon"}function s(e,t,r,n,i){this.type="TripleConstraint",this.inverse=!!r,this.negated=!!n,this.predicate=t,void 0!==i&&(this.valueExpr=i)}function a(e){this.type="Choice",this.disjuncts=e}function o(e){this.type="EachOf",this.conjuncts=e}function c(e,t){this.type="SemActs",this.expression=e,this.semActs=t}function u(e){this.type="KleeneStar",this.expression=e}return e?function e(n,p){var l;function f(e,r,n){if(void 0===r&&(r=1),void 0===n&&(n=1),1===r&&1===n)return e;var s=n===t?new u(e):E(n-r).reduce(function(t,r,n){return new a(0===n?[e,new i]:[new o([e,t]),new i])},void 0);return 0!==r?new o(E(r).map(function(t){return e}).concat(s)):s}if("TripleConstraint"===n.type){var d="valueExprRef"in n?p.valueExprDefns[n.valueExprRef]:n.valueExpr;return l=f(new s(r.push(n)-1,n.predicate,n.inverse,n.negated,d),n.min,n.max),n.semActs?new c(l,n.semActs):l}if("OneOf"===n.type)return l=f(new a(n.expressions.map(function(t){return e(t,p)})),n.min,n.max),n.semActs?new c(l,n.semActs):l;if("EachOf"===n.type)return l=f(new o(n.expressions.map(function(t){return e(t,p)})),n.min,n.max),n.semActs?new c(l,n.semActs):l;if("Inclusion"===n.type)return e(p.shapes[n.include].expression,p);throw Error("unexpected expr type: "+n.type)}(e,n):new i}var x=function(){function e(e){return s.isLiteral(e)?-1!==["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#double"].indexOf(s.getLiteralType(e))?parseInt(s.getLiteralValue(e)):e:s.isBlank(e)?e:"<"+e+">"}return e(this.subject)+" "+e(this.predicate)+" "+e(this.object)+" ."};function S(e){return{byPredicate:e.reduce(function(e,t){var r=t.predicate;return r in e||(e[r]=[]),e[r].push(t),i&&(t.toString=x),e},{}),candidates:E(e.length).map(function(){return[]}),misses:[]}}function b(e,t){var[r,n]=[e,t].map(e=>s.isBlank(e)?1:s.isLiteral(e)?2:3);return r===n?e.localeCompare(t):r-n}function E(e){return 0===e?[]:Array(e).join(" ").split(/ /)}function w(e,t,r){t in e||j("expected "+JSON.stringify(e)+" to have a '"+t+"' attribute."),arguments.length>2&&e[t]!==r&&j("expected "+t+" attribute '"+e[t]+"' to equal '"+r+"'.")}function O(){}function j(){var e=Array.prototype.join.call(arguments,""),t=new Error(e);throw Error.captureStackTrace(t,j),t}return{construct:function t(n,u){if(!(this instanceof t))return new t(n,u);this.type="ShExValidator",u=u||{},this.options=u,this.options.or=this.options.or||"someOf",this.options.partition=this.options.partition||"exhaustive","noCache"in u&&u.noCache||(this.known={});var f=this;this.schema=n,this._expect=this.options.lax?O:w,this._optimize={},this.reset=function(){};var x=this.options.regexModule||e("../lib/regex/threaded-val-nerr");this.getAST=function(){return{type:"AST",shapes:Object.keys(this.schema.shapes).reduce(function(e,t){return e[t]={type:"ASTshape",expression:g(f.schema.shapes[t].expression,[],f.schema)},e},{})}},this.indexTripleConstraints=function(e){var t=[];return e&&function e(r){"TripleConstraint"===r.type?t.push(r):"OneOf"===r.type||"EachOf"===r.type?r.expressions.forEach(function(t){e(t)}):"Inclusion"===r.type?e(n.productions[r.include]):j("unexpected expr type: "+r.type)}(e),t},this.emptyTracker=function(){var e=e=>e;return{recurse:e,known:e,enter:function(e,t){++this.depth},exit:function(e,t,r){--this.depth},depth:0}},this.validate=function(e,t,i,s,a){if("object"==typeof t){var o=t;if("api"===this.options.results)return o.map(t=>{var r=new Date,n=this.validate(e,t.node,t.shape,i,s);return r=new Date-r,{node:t.node,shape:t.shape,status:"errors"in n?"nonconformant":"conformant",appinfo:n,elapsed:r}});var c=o.reduce((t,r)=>{var n=this.validate(e,r.node,r.shape,s,a);return"errors"in n?{passes:t.passes,failures:t.failures.concat(n)}:{passes:t.passes.concat(n),failures:t.failures}},{passes:[],failures:[]});return c.failures.length?1!==c.failures.length?{type:"FailureList",errors:c.failures}:c.failures[0]:1!==c.passes.length?{type:"SolutionList",solutions:c.passes}:c.passes[0]}var u=void 0===s;s||(s=this.emptyTracker()),i&&i!==r||n.start||j("start production not defined");var p=null;i==r?p=n.start:"shapes"in this.schema&&0!==this.schema.shapes.length?i in this.schema.shapes?p=n.shapes[i]:j("shape "+i+" not found in:\n"+Object.keys(this.schema.shapes||[]).map(e=>"  "+e).join("\n")):j("shape "+i+" not found; no shapes in schema"),void 0===a&&(a={});var l=t+"@"+(i===r?"_: -start-":i);if(l in a)return s.recurse({type:"Recursion",node:m(t),shape:i});if("known"in this&&l in this.known)return s.known(this.known[l]);a[l]={point:t,shape:i},s.enter(t,i);var f=this._validateShapeExpr(e,t,p,i,s,a);return s.exit(t,i,f),delete a[l],"known"in this&&(this.known[l]=f),"startActs"in n&&u&&(f.startActs=n.startActs),f},this._validateShapeExpr=function(e,t,r,i,s,a){if(""===t)throw Error("validation needs a valid focus node");if("NodeConstraint"===r.type)return(o=this._errorsMatchingNodeConstraint(t,r,null)).length?{type:"Failure",node:m(t),shape:i,errors:o.map(function(e){return{type:"NodeConstraintViolation",shapeExpr:r,error:e}})}:{type:"NodeTest",node:m(t),shape:i,shapeExpr:r};if("Shape"===r.type)return this._validateShape(e,t,x.compile(n,r),r,i,s,a);if("ShapeRef"===r.type)return this._validateShapeExpr(e,t,n.shapes[r.reference],r.reference,s,a);if("ShapeExternal"===r.type)return this.options.validateExtern(e,t,i,s,a);if("ShapeOr"===r.type){for(var o=[],c=0;c<r.shapeExprs.length;++c){var u=r.shapeExprs[c];if(!("errors"in(l=this._validateShapeExpr(e,t,u,i,s,a))))return{type:"ShapeOrResults",solution:l};o.push(l)}return{type:"ShapeOrFailure",errors:o}}if("ShapeNot"===r.type)return"errors"in(l=this._validateShapeExpr(e,t,r.shapeExpr,i,s,a))?{type:"ShapeNotResults",solution:l}:{type:"ShapeNotFailure",errors:l};if("ShapeAnd"===r.type){var p=[];for(c=0;c<r.shapeExprs.length;++c){var l;if(u=r.shapeExprs[c],"errors"in(l=this._validateShapeExpr(e,t,u,i,s,a)))return{type:"ShapeAndFailure",errors:[l]};p.push(l)}return{type:"ShapeAndResults",solutions:p}}throw Error("expected one of Shape{Ref,And,Or} or NodeConstraint, got "+JSON.stringify(r))},this._validateShape=function(e,t,r,s,a,o,c){var u=this,p=null;if("startActs"in n&&!this.semActHandler.dispatchAll(n.startActs,null,{}))return{type:"Failure",node:m(t),shape:a,errors:["semact failure"]};for(var l=e.getNeighborhood(t,a,s),f=S(l.outgoing.sort((e,t)=>b(e.object,t.object))),d=S(l.incoming.sort((e,t)=>b(e.subject,t.subject))),h=l.outgoing.length,v=l.outgoing.concat(l.incoming),y=this.indexTripleConstraints(s.expression),g=y.reduce(function(t,r,n){r.inverse,r.inverse;var i=(r.inverse?d:f).byPredicate[r.predicate]||[],s=u._triplesMatchingShapeExpr(i,r.valueExpr,r.inverse,function(t,r){var n=u.validate(e,t,r,o,c);return"errors"in n?n.errors:[]},function(t,r){var n=u._validateShapeExpr(e,t,r,a,o,c);return"errors"in n?n.errors:[]});return s.hits.forEach(function(e){t.constraintList[v.indexOf(e)].push(n)}),s.misses.forEach(function(e){t.misses[v.indexOf(e.triple)]={constraintNo:n,errors:e.errors}}),t},{misses:{},constraintList:E(v.length).map(function(){return[]})}),x=[],w=g.constraintList.reduce(function(e,t,r){return 0===t.length&&r<h&&r in g.misses&&(void 0!==s.extra&&-1!==s.extra.indexOf(v[r].predicate)?x.push(r):e.push({tripleNo:r,constraintNo:g.misses[r].constraintNo,errors:g.misses[r].errors})),e},[]),O=function(e){var t=e.length,r=[],n=null;return{next:function(){if(null!==n&&0===n.length)return!1;if(null===n)return function(){n=[];for(var i=0;i<t;i++)r[i]=0,n[i]=e[i][0]}(),!0;var i=t-1;if(r[i]++,r[i]<e[i].length)return n[i]=e[i][r[i]],!0;for(;r[i]>=e[i].length;){if(0==i)return!1;r[i]=0,n[i]=e[i][0],r[--i]++}return n[i]=e[i][r[i]],!0},do:function(e,t){return e.apply(t,n)},get:function(){return n}}}(g.constraintList),j=[];0===w.length&&O.next()&&null===p;){var T=[],N=E(v.length).map(function(){return 0}),k=O.get();if(s.closed){var A=v.slice(0,h).filter((e,t)=>void 0===k[t]&&-1===x.indexOf(t));if(A.length>0){j.push({errors:[{type:"ClosedShapeViolation",unexpectedTriples:A}]});continue}}function _(){var e=y.length;return k.slice().reduce(function(e,t,r){return void 0!==t&&e[t].push(r),e},E(e).map(function(){return[]}))}function L(t,r){return u.validate(e,t,r,o,c)}function R(t,r){return u._validateShapeExpr(e,t,r,a,o,c)}function I(e,t,r,n){return u._errorsMatchingShapeExpr(e,t,r,n)}k.forEach(function(e,t){void 0!==e&&(T.push(v[t]),++N[e])}),k.slice().sort(function(e,t){return e-t}).filter(function(e){return void 0!==e}).map(function(e){return e+" "}).join("");var C=r.match(e,t,y,_(),k,v,L,R,this.semActHandler,I,null);if("errors"in C){if(j.push({errors:C.errors}),"exhaustive"!==u.options.partition)break}else{var D={type:"ShapeTest",node:m(t),shape:a};if(Object.keys(C).length>0&&(D.solution=C),"semActs"in s&&!this.semActHandler.dispatchAll(s.semActs,C,D)){if(j.push({errors:[{type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}]}),"exhaustive"!==u.options.partition)break}else p=D}}if(null===p){var V=w.map(function(e){var t=v[e.tripleNo];return{type:"TypeMismatch",triple:{type:"TestedTriple",subject:t.subject,predicate:t.predicate,object:m(t.object)},constraint:y[e.constraintNo],errors:e.errors}});p={type:"Failure",node:m(t),shape:a,errors:V.concat(1===j.length?j[0].errors:j)}}return i&&v.forEach(function(e){delete e.toString}),function(e){return"annotations"in s&&(e.annotations=s.annotations),e}(p)},this._triplesMatchingShapeExpr=function(e,t,r,n,i){var s=this,a=[],o=[];return e.forEach(function(e){var c=r?e.subject:e.object,u=void 0===t?[]:s._errorsMatchingShapeExpr(c,t,n,i);0===u.length?o.push(e):-1===o.indexOf(e)&&a.push({triple:e,errors:u})}),{hits:o,misses:a}},this._errorsMatchingShapeExpr=function(e,t,r,n){var i=this;if("NodeConstraint"===t.type)return this._errorsMatchingNodeConstraint(e,t,null);if("Shape"===t.type)return void 0===n?[]:n(e,t);if("ShapeRef"===t.type)return r?r(e,t.reference):[];if("ShapeOr"===t.type){for(var s=[],a=0;a<t.shapeExprs.length;++a){var o=i._errorsMatchingShapeExpr(e,t.shapeExprs[a],r,n);if(0===o.length)return o;s=s.concat(o)}return s}if("ShapeAnd"===t.type)return t.shapeExprs.reduce(function(t,s,a){return t.concat(i._errorsMatchingShapeExpr(e,s,r,n,!0))},[]);if("ShapeNot"===t.type)return(s=i._errorsMatchingShapeExpr(e,t.shapeExpr,r,n,!0)).length?[]:["Error validating "+e+" as "+JSON.stringify(t)+": expected NOT to pass"];throw Error("unknown value expression type '"+t.type+"'")},this._errorsMatchingNodeConstraint=function(e,t,r){var n=[],i=s.isLiteral(e)?s.getLiteralValue(e):s.isBlank(e)?e.substring(2):e,u=s.isLiteral(e)?s.getLiteralType(e):null,f=-1!==c.indexOf(u)?o+"integer":-1!==p.indexOf(u)?u:void 0;function g(){var r=Array.prototype.join.call(arguments,"");return n.push("Error validating "+e+" as "+JSON.stringify(t)+": "+r),!1}if("nodeKind"in t&&(-1===["iri","bnode","literal","nonliteral"].indexOf(t.nodeKind)&&g("unknown node kind '"+t.nodeKind+"'"),s.isBlank(e)?"iri"!==t.nodeKind&&"literal"!==t.nodeKind||g("blank node found when "+t.nodeKind+" expected"):s.isLiteral(e)?"literal"!==t.nodeKind&&g("literal found when "+t.nodeKind+" expected"):"bnode"!==t.nodeKind&&"literal"!==t.nodeKind||g("iri found when "+t.nodeKind+" expected")),t.datatype&&t.values&&g("found both datatype and values in "+tripleConstraint),t.datatype&&(s.isLiteral(e)?s.getLiteralType(e)!==t.datatype?g("mismatched datatype: "+s.getLiteralType(e)+" !== "+t.datatype):f?testRange(l[f](i,g),t.datatype,g):t.datatype===o+"boolean"?"true"!==i&&"false"!==i&&"1"!==i&&"0"!==i&&g("illegal boolean value: "+i):t.datatype===o+"dateTime"&&(i.match(/^[+-]?\d{4}-[01]\d-[0-3]\dT[0-5]\d:[0-5]\d:[0-5]\d(\.\d+)?([+-][0-2]\d:[0-5]\d|Z)?$/)||g("illegal dateTime value: "+i)):g("mismatched datatype: "+e+" is not a literal with datatype "+t.datatype)),t.values&&(s.isLiteral(e)&&t.values.reduce((t,r)=>{if(t)return!0;var n=m(e);return"Language"===r.type?r.languageTag===n.language:"object"==typeof r&&"value"in r&&r.value===n.value&&r.type===n.type&&r.language===n.language},!1)||-1!==t.values.indexOf(e)||t.values.some(function(t){if("object"==typeof t&&!("value"in t)){"type"in t||j("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var r=["Language","IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];function n(e,r,n){return s.isLiteral(e)?-1!==["LiteralStem","LiteralStemRange"].indexOf(t.type)?n(s.getLiteralValue(e),r):-1!==["LanguageStem","LanguageStemRange"].indexOf(t.type)?n(s.getLiteralLanguage(e)||null,r):g("literal "+e+" not comparable with non-literal "+r):-1===["IriStem","IriStemRange"].indexOf(t.type)?g("nonliteral "+e+" not comparable with literal "+JSON.stringify(r)):n(e,r)}function i(e,r){return n(e,r,(e,r)=>"LanguageStem"===t.type||"LanguageStemRange"===t.type?null!==e&&(e===r||""===r||"-"===e[r.length]):e.startsWith(r))}if(-1===r.indexOf(t.type)&&j("expected type attribute '"+t.type+"' to be in '"+r+"'."),y(t.stem)){if(!i(e,t.stem))return!1}else w(t.stem,"type","Wildcard");return!t.exclusions||!t.exclusions.some(function(t){if(y(t))return n(e,t,(e,t)=>e===t);"type"in t||j("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var r=["IriStem","LiteralStem","LanguageStem"];return-1===r.indexOf(t.type)&&j("expected type attribute '"+t.type+"' to be in '"+r+"'."),i(e,t.stem)})}})||g("value "+e+" not found in set "+JSON.stringify(t.values))),"pattern"in t){var x="flags"in t?new RegExp(t.pattern,t.flags):new RegExp(t.pattern);a(e).match(x)||g("value "+a(e)+" did not match pattern "+t.pattern)}return Object.keys(d).forEach(function(r){r in t&&!d[r](i,t[r])&&g("facet violation: expected "+r+" of "+t[r]+" but got "+e)}),Object.keys(h).forEach(function(r){r in t&&(f?h[r](l[f](i,g),t[r])||g("facet violation: expected "+r+" of "+t[r]+" but got "+e):g("facet violation: numeric facet "+r+" can't apply to "+e))}),Object.keys(v).forEach(function(r){r in t&&(f===o+"integer"||f===o+"decimal"?v[r](""+l[f](i,g),t[r])||g("facet violation: expected "+r+" of "+t[r]+" but got "+e):g("facet violation: numeric facet "+r+" can't apply to "+e))}),n},this.semActHandler={handlers:{},results:{},register:function(e,t){this.handlers[e]=t},dispatchAll:function(e,t,r){var n=this;return e.reduce(function(e,i){if(e&&i.name in n.handlers){var s="code"in i?i.code:f.options.semActs[i.name],a="extensions"in r&&i.name in r.extensions,o=a?r.extensions[i.name]:{};return e=e&&n.handlers[i.name].dispatch(s,t,o),!a&&Object.keys(o).length>0&&("extensions"in r||(r.extensions={}),r.extensions[i.name]=o),e}return e},!0)}}},start:r,options:{or:{oneOf:"exactly one disjunct must pass",someOf:"one or more disjuncts must pass",firstOf:"disjunct evaluation stops after one passes"},partition:{greedy:"each triple constraint consumes all triples matching predicate and object",exhaustive:"search all mappings of triples to triple constriant"}}}}();void 0!==e&&void 0!==r&&(t.exports=i)}).call(this,e("_process"))},{"../lib/regex/nfax-val-1err":17,"../lib/regex/threaded-val-nerr":18,"./RdfTerm":13,_process:3}],16:[function(e,t,r){var n=function(){var t=e("util"),r=-1,n=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,i=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,s={"\\":"\\\\",'"':'\\"',"/":"\\/","\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"},a={iri:"IRI",bnode:"BNODE",literal:"LITERAL",nonliteral:"NONLITERAL"};function o(e,t){if(!(this instanceof o))return new o(e,t);if(e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e)this._outputStream=e,this._endStream=void 0===t.end||!!t.end;else{var r="";this._outputStream={write:function(e,t,n){r+=e,n&&n()},end:function(e){e&&e(null,r)}},this._endStream=!0}this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),this._error=t.error||p,this.forceParens=!t.simplifyParentheses,this._expect=t.lax?f:l}function c(e){var t=s[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}function u(e){return e.replace(/\\/g,"\\\\").replace(/%/g,"\\%")}function p(e,t){"function"!=typeof e&&(t=e,e=p);var r=new Error(t);throw Error.captureStackTrace(r,e),r}function l(e,t,r){t in e||this._error(l,"expected "+e+" to have a ."+t),arguments.length>2&&e[t]!==r&&this._error(l,"expected "+e[e]+" to equal ."+r)}function f(){}return o.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeSchema:function(e,t){var r=this;this._expect(e,"type","Schema"),r.addPrefixes(e.prefixes),e.base&&r._write("BASE "+this._encodeIriOrBlankNode(e.base)+"\n"),e.imports&&e.imports.forEach(function(e){r._write("IMPORT "+r._encodeIriOrBlankNode(e)+"\n")}),e.startActs&&e.startActs.forEach(function(e){r._expect(e,"type","SemAct"),r._write(" %"+r._encodePredicate(e.name)+("code"in e?"{"+u(e.code)+"%}":"%"))}),e.start&&r._write("start = "+r._writeShapeExpr(e.start,t,!0,0).join("")+"\n"),"shapes"in e&&Object.keys(e.shapes).forEach(function(n){r._write(r._encodeShapeName(n,!1)+" "+r._writeShapeExpr(e.shapes[n],t,!0,0).join("")+"\n",t)})},_writeShapeExpr:function(e,r,n,i){var s=this,a=[];if("ShapeRef"===e.type)a.push("@",s._encodeShapeName(e.reference));else if("ShapeExternal"===e.type)a.push("EXTERNAL");else if("ShapeAnd"===e.type){i>=3&&a.push("(");var o=!1;e.shapeExprs.forEach(function(t,n){if(n>0){function i(t){let r=e.shapeExprs[t];return!("NodeConstraint"!==r.type||"nodeKind"in r&&"literal"===r.nodeKind||"datatype"in r||"values"in r)}let t=!o&&(i(n-1)&&function(t){let r=e.shapeExprs[t];return"Shape"===r.type||"ShapeRef"===r.type}(n)||(c=n-1,"Shape"===e.shapeExprs[c].type&&i(n)));t||a.push(" AND "),o=t}var c;a=a.concat(s._writeShapeExpr(t,r,!1,3))}),i>=3&&a.push(")")}else if("ShapeOr"===e.type)i>=2&&a.push("("),e.shapeExprs.forEach(function(e,t){t>0&&a.push(" OR "),a=a.concat(s._writeShapeExpr(e,r,n,2))}),i>=2&&a.push(")");else if("ShapeNot"===e.type)i>=4&&a.push("("),a.push("NOT "),a=a.concat(s._writeShapeExpr(e.shapeExpr,r,n,4)),i>=4&&a.push(")");else if("Shape"===e.type)a=a.concat(s._writeShape(e,r,n));else{if("NodeConstraint"!==e.type)throw Error("expected Shape{,And,Or,Ref} or NodeConstraint in "+t.inspect(e));a=a.concat(s._writeNodeConstraint(e,r,n))}return a},_writeShape:function(e,t,n){var i,s=this;try{var a=[];this._expect(e,"type","Shape"),e.closed&&a.push("CLOSED "),e.extra&&e.extra.length>0&&(a.push("EXTRA "),e.extra.forEach(function(e,t){a.push(s._encodeShapeName(e,!1)+" ")}),a.push(" "));function o(e,t){0===e&&1===t?a.push("?"):0===e&&t===r?a.push("*"):void 0===e&&void 0===t||(1===e&&t===r?a.push("+"):a.push("{",e,",",t===r?"*":t,"}"))}return a.push("{\n"),e.expression&&function e(r,n,i){function c(e){e&&e.forEach(function(e){s._expect(e,"type","SemAct"),a.push("\n"+n+"   %"),a.push(s._encodeValue(e.name)),"code"in e?a.push("{"+u(e.code)+"%}"):a.push("%")})}function p(t,r,s,o){var c=s<i||o;c&&a.push("("),t.forEach(function(i,o){e(i,n+"  ",s),o<t.length-1&&a.push(r)}),c&&a.push(")")}if("id"in r&&(a.push("$"),a.push(s._encodeIriOrBlankNode(r.id,!0))),"TripleConstraint"===r.type)r.inverse&&a.push("^"),r.negated&&a.push("!"),a.push(n,s._encodePredicate(r.predicate)," "),"valueExpr"in r?a=a.concat(s._writeShapeExpr(r.valueExpr,t,!0,0)):a.push(". "),o(r.min,r.max),s._annotations(a,r.annotations,n),c(r.semActs);else if("OneOf"===r.type){var l="id"in r||"min"in r||"max"in r||"annotations"in r||"semActs"in r;p(r.expressions,"\n"+n+"| ",1,l||s.forceParens),o(r.min,r.max),s._annotations(a,r.annotations,n),c(r.semActs)}else if("EachOf"===r.type)l="id"in r||"min"in r||"max"in r||"annotations"in r||"semActs"in r,p(r.expressions,";\n"+n,2,l||s.forceParens),o(r.min,r.max),s._annotations(a,r.annotations,n),c(r.semActs);else{if("Inclusion"!==r.type)throw Error("unexpected expr type: "+r.type);a.push("&"),a.push(s._encodeShapeName(r.include,!1))}}(e.expression,"  ",0),a.push("\n}"),(i=e.semActs)&&i.forEach(function(e){s._expect(e,"type","SemAct"),a.push(" %",s._encodePredicate(e.name),"code"in e?"{"+u(e.code)+"%}":"%")}),s._annotations(a,e.annotations,"  "),a}catch(e){t&&t(e)}},_writeNodeConstraint:function(e,t){try{this._expect(e,"type","NodeConstraint");var r=[];return e.nodeKind in a?r.push(a[e.nodeKind]," "):void 0!==e.nodeKind&&this._error("unexpected nodeKind: "+e.nodeKind),this._fillNodeConstraint(r,e,t),this._annotations(r,e.annotations,"  "),r}catch(e){t&&t(e)}},_annotations:function(e,t,r){var n=this;t&&t.forEach(function(t){n._expect(t,"type","Annotation"),e.push("//\n"+r+"   "),e.push(n._encodeValue(t.predicate)),e.push(" "),e.push(n._encodeValue(t.object))})},_fillNodeConstraint:function(e,t,r){var n=this;if(t.datatype&&t.values&&n._error("found both datatype and values in "+expr),t.datatype&&e.push(n._encodeShapeName(t.datatype)),t.values&&(e.push("["),t.values.forEach(function(t,r){if(r>0&&e.push(" "),o(t))e.push(n._encodeValue(t));else{"type"in t||runtimeError("expected "+JSON.stringify(t)+" to have a 'type' attribute.");var s=["Language","IriStem","LiteralStem","LanguageStem","IriStemRange","LiteralStemRange","LanguageStemRange"];function a(e,t){return-1!==["LanguageStem","LanguageStemRange"].indexOf(e.type)?"@"+t:-1!==["LiteralStem","LiteralStemRange"].indexOf(e.type)?'"'+t.replace(i,t)+'"':n._encodeValue(t)}-1===s.indexOf(t.type)&&runtimeError("expected type attribute '"+t.type+"' to be in '"+s+"'."),"Language"===t.type?e.push("@"+t.languageTag):o(t.stem)?e.push(a(t,t.stem)+"~"):(l(t.stem,"type","Wildcard"),e.push(".")),t.exclusions&&t.exclusions.forEach(function(r){if(e.push(" - "),o(r))e.push(a(t,r));else{"type"in r||runtimeError("expected "+JSON.stringify(r)+" to have a 'type' attribute.");var n=["IriStem","LiteralStem","LanguageStem"];-1===n.indexOf(r.type)&&runtimeError("expected type attribute '"+r.type+"' to be in '"+n+"'."),e.push(a(t,r.stem)+"~")}})}}),e.push("]")),"pattern"in t){var s=t.pattern.replace(/\//g,"\\/"),a="flags"in t?t.flags:"";e.push("/"+s+"/"+a+" ")}return["length","minlength","maxlength","mininclusive","minexclusive","maxinclusive","maxexclusive","totaldigits","fractiondigits"].forEach(function(r){t[r]&&e.push(" ",r," ",t[r])}),e;function o(e){return"object"!=typeof e||"value"in e&&Object.keys(e).reduce((e,t)=>!1===e?e:-1!==["value","type","language"].indexOf(t),!0)}},_encodeIriOrBlankNode:function(e,t){if(t=t?" ":"","_"===e[0]&&":"===e[1])return e;n.test(e)&&(e=e.replace(i,c));var r=this._prefixRegex.exec(e);return r?(r[1]?this._prefixIRIs[r[1]]+r[2]:e)+t:"<"+e+">"},_encodeLiteral:function(e,t,r){return n.test(e)&&(e=e.replace(i,c)),r?'"'+e+'"@'+r:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeShapeName:function(e,t){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return this._encodeIriOrBlankNode(e,t)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e?"a":this._encodeIriOrBlankNode(e)},_encodeValue:function(e){return"object"!=typeof e?this._encodeIriOrBlankNode(e):this._encodeLiteral(e.value,e.type,e.language)},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},writeSchema:function(e,t){this._writeSchema(e,t),this.end(t)},addShape:function(e,t,r){this._write(_ShExWriter._encodeShapeName(t,!1)+" "+_ShExWriter._writeShapeExpr(e,r,!0,0).join(""),r)},addShapes:function(e){for(var t=0;t<e.length;t++)this.addShape(e[t])},addPrefix:function(e,t,r){var n={};n[e]=t,this.addPrefixes(n,r)},addPrefixes:function(e,t){var r=this._prefixIRIs,n=!1;for(var i in e){var s=e[i];r[s]!==(i+=":")&&(n=!0,r[s]=i,this._write("PREFIX "+i+" <"+s+">\n"))}if(n){var a="",o="";for(var c in r)a+=a?"|"+c:c,o+=(o?"|":"")+r[c];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+o+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(n?"\n":"",t)},_prefixRegex:/$0^/,end:function(e){this._write=this._blockedWrite;var t=e&&function(r,n){t=null,e(r,n)};if(this._endStream)try{return this._outputStream.end(t)}catch(e){}t&&t()}},o}();void 0!==e&&void 0!==r&&(t.exports=n)},{util:12}],17:[function(e,t,r){var n=function(){var t=e("../RdfTerm"),n="<span class='keyword' title='Split'>|</span>",i="<span class='keyword' title='Repeat'>×</span>",s="<span class='keyword' title='Match'>␃</span>",a=-1;function o(e){e||(e={});for(var t,r=1,n=arguments.length;r<n&&(t=arguments[r]||{});r++)for(var i in t)e[i]=t[i];return e}return r={name:"nfax-val-1err",description:"simple regular expression engine with n out states",compile:function(e,r){var c=r.expression;return function(){var t=[],r=f(s,[]),o=r;if(c){var p=function r(s,o){var c,u,l;function h(e,r){return null!=s.min&&1!==s.min||null!=s.max&&1!==s.max?(c=f(i,[e]),t[c].expr=s,t[c].min="min"in s?s.min:1,t[c].max="max"in s?s.max===a?1/0:s.max:1,d(r,c),{start:c,tail:[c]}):{start:e,tail:r}}if("TripleConstraint"===s.type)return c=f(s,[]),t[c].stack=o,{start:c,tail:[c]};if("OneOf"===s.type)return l=[],u=[],s.expressions.forEach(function(e,t){p=r(e,o.concat({c:s,e:t})),u.push(p.start),l=l.concat(p.tail)}),c=f(n,u),t[c].expr=s,h(c,l);if("EachOf"===s.type)return s.expressions.forEach(function(e,t){p=r(e,o.concat({c:s,e:t})),0===t?c=p.start:d(l,p.start),l=p.tail}),h(c,l);if("Inclusion"===s.type){var v=e.productions[s.include];return r(v,o)}throw Error("unexpected expr type: "+s.type)}(c,[]);d(p.tail,r),o=p.start}var l={algorithm:"rbenx",end:r,states:t,start:o,match:u};return r=t=o=null,l;function f(e,r,n){var i=t.length;return t.push({c:e,outs:r}),n&&(t[i].negated=!0),i}function d(e,r){e.forEach(e=>{t[e].outs.push(r)})}}();function u(r,n,i,s,c,u,h,v,m,y,g){var x=this,S=[],b=[];function E(e){return e.map(e=>{var t=x.states[e.state];return renderAtom(t.c,t.negated)})}if(1===x.states.length)return d([],0,u,h,v,m,y);var w=null;for(l(x,S,this.start,{repeats:{},avail:[],matched:[],stack:[],errors:[]});S.length;){b=[],g&&g.push({threads:[]});for(var O=0;O<S.length;++O){var j=S[O];if(j.state!==x.end){var T=x.states[j.state],N=b.length,k=i.indexOf(T.c),A="min"in T.c?T.c.min:1,_="max"in T.c?T.c.max===a?1/0:T.c.max:1;"negated"in T.c&&T.c.negated&&(A=_=0),void 0===j.avail[k]&&(j.avail[k]=s[k].slice());var L=j.avail[k].splice(0,_);if(L.length>=A)do{p(x,b,j,L)}while(j.avail[k].length>0&&L.length<_&&(L.push(j.avail[k].shift()),1));g&&g[g.length-1].threads.push({state:S[O].state,to:b.slice(N).map(e=>f(e.state,e.repeats))})}}if(0===b.length&&null===w)return C(E(x.states));var R=S;S=b,b=R;var I=S.reduce((e,t)=>{var r=t.matched.reduce((e,t)=>e+t.triples.length,0)===c.reduce((e,t)=>void 0===t?e:e+1,0);return null!==e?e:t.state===x.end&&r?t:null},null);I&&(w=I)}if(null===w)return C();function C(){return{type:"Failure",node:n,errors:E(x.states)}}function E(){return S.map(r=>{var n=o({},x.states[r.state].c.valueExpr);if("reference"in n){var i=n.reference;t.isBlank(i)&&(n.reference=e.shapes[i])}return o({type:T.c.negated?"NegatedProperty":r.state===x.end?"ExcessTripleViolation":"MissingProperty",property:T.c.predicate},Object.keys(n).length>0?{valueExpr:n}:{})})}return"errors"in w.matched?w.matched:d(w.matched,0,u,h,v,m,y)}function p(e,t,r,n){var s=e.states[r.state],a=e.states.map(e=>e.c===i?e.expr:null),o=s.stack.map(e=>{var t=r.repeats[a.indexOf(e.c)];return void 0===t?t=0:t-=1,{c:e.c,e:e.e,i:t}}),c={c:s.c,triples:n,stack:o};r.matched=r.matched.concat(c),s.outs.forEach(n=>{l(e,t,n,r)})}function l(e,t,r,s,a){a=a||[];var o=f(r,s.repeats);if(-1===a.indexOf(o)){a.push(o);var c=e.states[r];if(c.c===n)return c.outs.reduce((r,n,i)=>r.concat(l(e,t,n,s,a)),[]);if(c.c===i){var u=[];r in s.repeats||(s.repeats[r]=0);var p=s.repeats[r];return p<c.max&&(u=u.concat(l(e,t,c.outs[0],function(e,t){var r=Object.keys(e.repeats).reduce((r,n)=>(r[n]=parseInt(n)==t?e.repeats[n]+1:e.repeats[n],r),{});return{state:e.state,repeats:r,matched:e.matched,avail:e.avail.slice(),stack:e.stack}}(s,r),a))),p>=c.min&&p<=c.max&&(u=u.concat(l(e,t,c.outs[1],function(e,t){var r=Object.keys(e.repeats).reduce((r,n)=>(parseInt(n)!==t&&(r[n]=e.repeats[n]),r),{});return{state:e.state,repeats:r,matched:e.matched,avail:e.avail.slice(),stack:e.stack}}(s,r),a))),u}return[t.push({state:r,repeats:s.repeats,avail:s.avail.map(e=>e.slice()),stack:s.stack,matched:s.matched,errors:s.errors})-1]}}function f(e,t){var r=Object.keys(t).map(e=>e+":"+t[e]).join(",");return r.length?e+"-"+r:""+e}function d(e,n,i,s,a,o,c){var u=[],p=[],l=[],f=e.reduce((e,r)=>{for(var n,d=0,h=e;d<u.length&&r.stack[d].c===u[d].c&&r.stack[d].i===u[d].i&&r.stack[d].e===u[d].e;)h=h.solutions[u[d].i].expressions[u[d].e],++d;for(;d<r.stack.length;){if(d>=u.length&&u.push({}),r.stack[d].c!==u[d].c){if(n=[],h.type="EachOf"===r.stack[d].c.type?"EachOfSolutions":"OneOfSolutions",h.solutions=n,"min"in r.stack[d].c&&(h.min=r.stack[d].c.min),"max"in r.stack[d].c&&(h.max=r.stack[d].c.max),"annotations"in r.stack[d].c&&(h.annotations=r.stack[d].c.annotations),"semActs"in r.stack[d].c&&(h.semActs=r.stack[d].c.semActs),h=n,u[d].i=null,"semActs"in r.stack[d].c&&!o.dispatchAll(r.stack[d].c.semActs,"???",h))throw{type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]};f&&"semActs"in expr&&(f.semActs=expr.semActs)}else h=h.solutions;if(r.stack[d].i!==u[d].i?(n=[],h[r.stack[d].i]={type:"EachOf"===r.stack[d].c.type?"EachOfSolution":"OneOfSolution",expressions:n},h=n,u[d].e=null):h=h[u[d].i].expressions,r.stack[d].e===u[d].e)throw"how'd we get here?";n={},h[r.stack[d].e]=n,r.stack[d].e>0&&void 0===h[r.stack[d].e-1]&&-1===l.indexOf(h)&&l.push(h),h=n,u.length=d+1,++d}return h.type="TripleConstraintSolutions","min"in r.c&&(h.min=r.c.min),"max"in r.c&&(h.max=r.c.max),h.predicate=r.c.predicate,"valueExpr"in r.c&&(h.valueExpr=r.c.valueExpr),"productionLabel"in r.c&&(h.productionLabel=r.c.productionLabel),h.solutions=r.triples.map(e=>{var n=i[e],u={type:"TestedTriple",subject:n.subject,predicate:n.predicate,object:function(e){if('"'!==e[0])return e;var r={value:t.getLiteralValue(e)},n=t.getLiteralType(e);n&&"http://www.w3.org/2001/XMLSchema#string"!==n&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==n&&(r.type=n);var i=t.getLiteralLanguage(e);return i&&(r.language=i),r}(n.object)};function l(e,r,n){var i=n(e,r);if("errors"in i){var s={type:"ReferenceError",focus:e,shape:r,errors:i};return"string"==typeof shapeLabel&&t.isBlank(shapeLabel)&&(s.referencedShape=r),[s]}return("solution"in i&&0!==Object.keys(i.solution).length||"Recursion"===i.type)&&(u.referenced=i),[]}return"valueExpr"in h&&(p=p.concat(c(h.inverse?n.subject:n.object,h.valueExpr,function(e,t){return l(e,t,s)},function(e,t){return l(e,t,a)}))),0===p.length&&"semActs"in r.c&&!o.dispatchAll(r.c.semActs,n,u)&&p.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),u}),"annotations"in r.c&&(h.annotations=r.c.annotations),"semActs"in r.c&&(h.semActs=r.c.semActs),u=r.stack.slice(),e},{});return p.length?{type:"SemActFailure",errors:p}:(l.forEach(e=>{for(var t=0;t<e.length;++t)null!==e[t]&&void 0!==e[t]||e.splice(t--,1)}),"semActs"in r&&(f.semActs=r.semActs),f)}}}}();void 0!==e&&void 0!==r&&(t.exports=n)},{"../RdfTerm":13}],18:[function(e,t,r){var n=function(){var t=e("../RdfTerm"),r=-1;function n(e){e||(e={});for(var t,r=1,n=arguments.length;r<n&&(t=arguments[r]||{});r++)for(var i in t)e[i]=t[i];return e}return{name:"threaded-val-nerr",description:"emulation of regular expression engine with error permutations",compile:function(e,i){var s=i.expression;return{match:function(a,o,c,u,p,l,f,d,h,v,m){if(!s)return{};var y=function i(s,a){var o=c.indexOf(s),p="min"in s?s.min:1,l="max"in s?s.max===r?1/0:s.max:1;function f(e,t){var r=0,i=[a],o={};("min"in s&&1!==s.min||"max"in s&&1!==s.max)&&(o.min=s.min,o.max=s.max),"semActs"in s&&(o.semActs=s.semActs),"annotations"in s&&(o.annotations=s.annotations);for(;r<l;++r){for(var c=[],u=0;u<i.length;++u){var f=i[u],d=t(f);if(d.length>0&&0===d[0].errors.length&&d.forEach(t=>{var r="expression"in f?f.expression.solutions:[];"solution"in t&&(r=r.concat(t.solution)),delete t.solution,t.expression=n({type:e,solutions:r},o)}),0===d.length||d[0].errors.length>0)return r<p?d:i;c=c.concat(d)}i=c}if(i.length>0&&0===i[0].errors.length&&"semActs"in s){var v=[],m=[];i.forEach(e=>{h.dispatchAll(s.semActs,"???",e)?v.push(e):(e.errors.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),m.push(e))}),i=v.length>0?v:m}return i}if("TripleConstraint"===s.type){var d="negated"in s&&s.negated||0===l;d&&(p=l=1/0),void 0===a.avail[o]&&(a.avail[o]=u[o].slice());var v={};("min"in s&&1!==s.min||"max"in s&&1!==s.max)&&(v.min=s.min,v.max=s.max),"semActs"in s&&(v.semActs=s.semActs),"annotations"in s&&(v.annotations=s.annotations);var m=a.avail[o].splice(0,p),y=d?0===m.length:m.length>=p,g=[],x=a.matched;if(y)do{g.push({avail:a.avail.map(e=>e.slice()),errors:a.errors.slice(),matched:x.concat({tNos:m.slice()}),expression:n({type:"TripleConstraintSolutions",predicate:s.predicate,solutions:m.map(e=>({type:"halfTestedTriple",tripleNo:e,constraintNo:o}))},"valueExpr"in s?{valueExpr:s.valueExpr}:{},"productionLabel"in s?{productionLabel:s.productionLabel}:{},v)})}while(a.avail[o].length>0&&m.length<l&&(m.push(a.avail[o].shift()),1));else{var S=n({},s.valueExpr);if("reference"in S){var b=S.reference;t.isBlank(b)&&(S.reference=e.shapes[b])}g.push({avail:a.avail,errors:a.errors.concat([n({type:d?"NegatedProperty":"MissingProperty",property:s.predicate},Object.keys(S).length>0?{valueExpr:S}:{})]),matched:x})}return g}if("OneOf"===s.type)return f("OneOfSolutions",e=>{var t=[],r=[];return s.expressions.forEach(n=>{var s={avail:e.avail.map(e=>e.slice()),errors:e.errors,matched:e.matched},a=i(n,s);0===a[0].errors.length?(t=t.concat(a),a.forEach(e=>{var t="solution"in s?s.solution.expressions:[];"expression"in e&&(t=t.concat([e.expression])),delete e.expression,e.solution={type:"OneOfSolution",expressions:t}})):r=r.concat(a)}),t.length>0?t:r});if("EachOf"===s.type)return f("EachOfSolutions",e=>s.expressions.reduce((e,t)=>e.reduce((e,r)=>{var n=i(t,r);return n.forEach(e=>{if(0===e.errors.length){var t="solution"in r?r.solution.expressions:[];"expression"in e&&(t=t.concat([e.expression])),delete e.expression,e.solution={type:"EachOfSolution",expressions:t}}}),e.concat(n)},[]),[e]));if("Inclusion"===s.type){var E=e.productions[s.include];return i(E,a)}runtimeError("unexpected expr type: "+s.type)}(s,{avail:[],matched:[],errors:[]}),g=y.reduce((e,t)=>{if(t.errors.length>0)return e;var r={};return Object.keys(p).forEach(e=>{void 0!==p[e]&&(r[e]=p[e])}),t.matched.forEach(e=>{e.tNos.forEach(e=>{delete r[e]})}),Object.keys(r).forEach(e=>{t.errors.push({type:"ExcessTripleViolation",triple:l[e],constraint:c[r[e]]})}),null!==e?e:Object.keys(r).length>0?null:t},null);return null!==g?function(e,r,n,s,a,o,c){return Object.keys(e).length>0&&function u(p){function l(e){if('"'!==e[0])return e;var r={value:t.getLiteralValue(e)},n=t.getLiteralType(e);n&&"http://www.w3.org/2001/XMLSchema#string"!==n&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"!==n&&(r.type=n);var i=t.getLiteralLanguage(e);return i&&(r.language=i),r}if("OneOfSolutions"===p.type||"EachOfSolutions"===p.type)p.solutions.forEach(e=>{e.expressions.forEach(e=>{u(e)})});else{if("TripleConstraintSolutions"!==p.type)throw Error("unexpected expr type in "+JSON.stringify(p));p.solutions=p.solutions.map(u=>{if("TestedTriple"===u.type)return u;var p=n[u.tripleNo],f=r[u.constraintNo],d={type:"TestedTriple",subject:p.subject,predicate:p.predicate,object:l(p.object)};function h(e,r,n){var s=n(e,r);if("errors"in s){var a={type:"ReferenceError",focus:e,shape:r};return"string"==typeof r&&t.isBlank(r)&&(a.referencedShape=i),a.errors=s,[a]}return("solution"in s&&0!==Object.keys(s.solution).length||"Recursion"===s.type)&&(d.referenced=s),[]}var v="valueExpr"in f?c(f.inverse?p.subject:p.object,f.valueExpr,function(e,t){return h(e,t,s)},function(e,t){return h(e,t,a)}):[];return 0===v.length&&"semActs"in f&&!o.dispatchAll(f.semActs,p,d)&&v.push({type:"SemActFailure",errors:[{type:"UntrackedSemActFailure"}]}),v.length>0&&(e.errors=e.errors||[],e.errors=e.errors.concat(v)),d})}}(e),"semActs"in i&&(e.semActs=i.semActs),e}(g.expression,c,l,f,d,h,v):y.length>1?{type:"PossibleErrors",errors:y.reduce((e,t)=>e.concat([t.errors]),[])}:y[0]}}}}}();void 0!==e&&void 0!==r&&(t.exports=n)},{"../RdfTerm":13}],19:[function(e,t,r){var n=function(){return{create:function(){let e={},t={},r={},n={};return{add:function(i,s){if(i in r&&-1!==r[i].indexOf(s))return;let a=i in n?u(i):e[i]=u(i),o=u(s);function c(e,t,r,n){e[n]=e[n].concat(r,e[r]),e[r].forEach(e=>t[e]=t[e].concat(n,t[n]))}function u(e){return e in n||(t[e]=[],r[e]=[],n[e]={}),n[e]}a[s]=o,s in e&&delete e[s],c(r,t,s,i),c(t,r,i,s)},roots:e,parents:t,children:r}},walk:function e(t,r,n){return Object.keys(t).reduce((i,s)=>i.concat(e(t[s],r,s),n?r(s,n):[]),[])}}}();void 0!==e&&void 0!==r&&(t.exports=n)},{}],20:[function(e,t,r){var n={RdfTerm:e("./lib/RdfTerm"),Util:e("./lib/ShExUtil"),Validator:e("./lib/ShExValidator"),Writer:e("./lib/ShExWriter"),"nfax-val-1err":e("./lib/regex/nfax-val-1err"),"threaded-val-nerr":e("./lib/regex/threaded-val-nerr")};void 0!==e&&void 0!==r&&(t.exports=n)},{"./lib/RdfTerm":13,"./lib/ShExUtil":14,"./lib/ShExValidator":15,"./lib/ShExWriter":16,"./lib/regex/nfax-val-1err":17,"./lib/regex/threaded-val-nerr":18}]},{},[20])(20)});